# ============================================
# ClaimEase AI - Render Deployment Config
# ============================================
# Backend deployment only (Frontend deployed on Vercel)
# This file defines the deployment configuration for Render.com

services:
  # ============================================
  # Backend API Service (Python/FastAPI)
  # ============================================
  - type: web
    name: claimease-backend
    env: python
    region: oregon  # Change to your preferred region (oregon, frankfurt, singapore)
    plan: free      # Free tier (512MB RAM)
    buildCommand: |
      pip install --upgrade pip
      pip install -r config/requirements.txt
    startCommand: uvicorn src.api:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /health
    
    # Environment Variables
    envVars:
      # Supabase Configuration (Add these in Render Dashboard)
      - key: SUPABASE_URL
        sync: false  # Set manually in Render dashboard
      
      - key: SUPABASE_SERVICE_ROLE_KEY
        sync: false  # Set manually in Render dashboard
      
      # OpenAI Configuration
      - key: OPENAI_API_KEY
        sync: false  # Set manually in Render dashboard
      
      # Knowledge Base Configuration
      - key: KNOWLEDGE_BASE_SOURCE
        value: supabase  # Use Supabase for knowledge base
      
      # Optional: Disable local ChromaDB
      - key: DISABLE_KNOWLEDGE_BASE
        value: "false"
      
      # FastAPI Environment
      - key: FASTAPI_ENV
        value: production
      
      # Frontend URL for CORS (set to your Vercel URL after deployment)
      - key: FRONTEND_URL
        sync: false  # Set manually in Render dashboard to your Vercel URL
    
    # Auto-deploy on push to main branch
    autoDeploy: true

# ============================================
# Frontend Service - DEPLOYED ON VERCEL
# ============================================
# The frontend (Next.js) is deployed on Vercel for:
# - Better Next.js integration
# - Faster deployments
# - No cold starts
# - Global CDN
#
# To deploy frontend:
# 1. Go to vercel.com
# 2. Import this GitHub repository
# 3. Vercel auto-detects Next.js
# 4. Add environment variables (see vercel.json)
# 5. Deploy!
#
# After deploying on Vercel:
# - Copy your Vercel URL
# - Add it to FRONTEND_URL env var above
# - Backend CORS will allow requests from Vercel

# ============================================
# Notes for Deployment:
# ============================================
# 1. Push this file to your GitHub repository
# 2. Connect your GitHub repo to Render
# 3. Render will auto-detect this file and create both services
# 4. Add secret environment variables in Render Dashboard:
#    - SUPABASE_URL
#    - SUPABASE_SERVICE_ROLE_KEY
#    - NEXT_PUBLIC_SUPABASE_ANON_KEY
#    - OPENAI_API_KEY
# 5. After backend deploys, update NEXT_PUBLIC_API_URL with actual backend URL
# 6. Both services will auto-deploy on git push to main
#
# Free Tier Limits:
# - 512 MB RAM per service
# - Spins down after 15 min inactivity
# - ~30 second cold start time
# - Unlimited bandwidth
# - Free SSL certificates
#
# Regions Available:
# - oregon (US West)
# - ohio (US East)
# - frankfurt (Europe)
# - singapore (Asia)

