# ============================================
# ClaimEase AI - Render Deployment Config
# ============================================
# This file defines the deployment configuration for Render.com
# Supports both Backend (Python/FastAPI) and Frontend (Next.js)

services:
  # ============================================
  # Backend API Service (Python/FastAPI)
  # ============================================
  - type: web
    name: claimease-backend
    env: python
    region: oregon  # Change to your preferred region (oregon, frankfurt, singapore)
    plan: free      # Free tier (512MB RAM)
    buildCommand: |
      pip install --upgrade pip
      pip install -r config/requirements.txt
    startCommand: uvicorn src.api:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /health
    
    # Environment Variables
    envVars:
      # Supabase Configuration (Add these in Render Dashboard)
      - key: SUPABASE_URL
        sync: false  # Set manually in Render dashboard
      
      - key: SUPABASE_SERVICE_ROLE_KEY
        sync: false  # Set manually in Render dashboard
      
      # OpenAI Configuration
      - key: OPENAI_API_KEY
        sync: false  # Set manually in Render dashboard
      
      # Knowledge Base Configuration
      - key: KNOWLEDGE_BASE_SOURCE
        value: supabase  # Use Supabase for knowledge base
      
      # Optional: Disable local ChromaDB
      - key: DISABLE_KNOWLEDGE_BASE
        value: "false"
      
      # FastAPI Environment
      - key: FASTAPI_ENV
        value: production
    
    # Auto-deploy on push to main branch
    autoDeploy: true

  # ============================================
  # Frontend Service (Next.js)
  # ============================================
  - type: web
    name: claimease-frontend
    env: node
    region: oregon  # Same region as backend for better latency
    plan: free      # Free tier (512MB RAM)
    buildCommand: |
      npm ci
      npm run build
    startCommand: npm start
    
    # Environment Variables
    envVars:
      - key: NODE_VERSION
        value: "18.19.0"
      
      # Backend API URL (Update after backend is deployed)
      - key: NEXT_PUBLIC_API_URL
        value: https://claimease-backend.onrender.com
      
      # Supabase Configuration (Add these in Render Dashboard)
      - key: NEXT_PUBLIC_SUPABASE_URL
        sync: false  # Set manually in Render dashboard
      
      - key: NEXT_PUBLIC_SUPABASE_ANON_KEY
        sync: false  # Set manually in Render dashboard
      
      - key: SUPABASE_SERVICE_ROLE_KEY
        sync: false  # Set manually in Render dashboard
      
      # Supabase Table Names
      - key: NEXT_PUBLIC_SUPABASE_SUMMARY_TABLE
        value: claim_summary
      
      - key: NEXT_PUBLIC_SUPABASE_ANALYSIS_TABLE
        value: claim_analysis
      
      - key: NEXT_PUBLIC_SUPABASE_CLAIMS_TABLE
        value: claims
      
      - key: NEXT_PUBLIC_SUPABASE_STORAGE_BUCKET
        value: claim_receipts
      
      # Next.js Configuration
      - key: NODE_ENV
        value: production
    
    # Auto-deploy on push to main branch
    autoDeploy: true

# ============================================
# Notes for Deployment:
# ============================================
# 1. Push this file to your GitHub repository
# 2. Connect your GitHub repo to Render
# 3. Render will auto-detect this file and create both services
# 4. Add secret environment variables in Render Dashboard:
#    - SUPABASE_URL
#    - SUPABASE_SERVICE_ROLE_KEY
#    - NEXT_PUBLIC_SUPABASE_ANON_KEY
#    - OPENAI_API_KEY
# 5. After backend deploys, update NEXT_PUBLIC_API_URL with actual backend URL
# 6. Both services will auto-deploy on git push to main
#
# Free Tier Limits:
# - 512 MB RAM per service
# - Spins down after 15 min inactivity
# - ~30 second cold start time
# - Unlimited bandwidth
# - Free SSL certificates
#
# Regions Available:
# - oregon (US West)
# - ohio (US East)
# - frankfurt (Europe)
# - singapore (Asia)

