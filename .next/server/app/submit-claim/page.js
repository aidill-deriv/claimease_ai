(()=>{var e={};e.id=490,e.ids=[490],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1337:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.a,__next_app__:()=>d,originalPathname:()=>h,pages:()=>u,routeModule:()=>p,tree:()=>c}),r(2870),r(2734),r(5866);var s=r(3191),i=r(8716),a=r(7922),n=r.n(a),o=r(5231),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);r.d(t,l);let c=["",{children:["submit-claim",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,2870)),"/Users/aidillfitri/Documents/Work/Github projects/claim_web_app_project/app/submit-claim/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,2734)),"/Users/aidillfitri/Documents/Work/Github projects/claim_web_app_project/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"]}],u=["/Users/aidillfitri/Documents/Work/Github projects/claim_web_app_project/app/submit-claim/page.tsx"],h="/submit-claim/page",d={require:r,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/submit-claim/page",pathname:"/submit-claim",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},1538:(e,t,r)=>{Promise.resolve().then(r.bind(r,4423))},4423:(e,t,r)=>{"use strict";let s;r.r(t),r.d(t,{default:()=>r1});var i,a,n,o,l,c,u,h,d,p,f,m,g,y=r(326),b=r(7577),v=r(5047),w=r(3113),_=r(3071),x=r(772),k=r(4432),j=r(5842),S=r(2881);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let E=(0,S.Z)("HeartPulse",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}],["path",{d:"M3.22 12H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27",key:"1uw2ng"}]]),T=(0,S.Z)("Plane",[["path",{d:"M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z",key:"1v9wt8"}]]),O=(0,S.Z)("ReceiptText",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M14 8H8",key:"1l3xfs"}],["path",{d:"M16 12H8",key:"1fr5h0"}],["path",{d:"M13 16H8",key:"wsln4y"}]]),N=(0,S.Z)("GraduationCap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]]),C=(0,S.Z)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);var A=r(1291),R=r(763);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let I=(0,S.Z)("ShieldOff",[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5 5a1 1 0 0 0-1 1v7c0 5 3.5 7.5 7.67 8.94a1 1 0 0 0 .67.01c2.35-.82 4.48-1.97 5.9-3.71",key:"1jlk70"}],["path",{d:"M9.309 3.652A12.252 12.252 0 0 0 11.24 2.28a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1v7a9.784 9.784 0 0 1-.08 1.264",key:"18rp1v"}]]),P=(0,S.Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);var $=r(1572),U=r(6283);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let D=(0,S.Z)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),L=(0,S.Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);var B=r(5826);let q=e=>e?(...t)=>e(...t):(...e)=>fetch(...e);class M extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class F extends M{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class V extends M{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class W extends M{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}!function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"}(i||(i={}));class K{constructor(e,{headers:t={},customFetch:r,region:s=i.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=q(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return(0,B.__awaiter)(this,arguments,void 0,function*(e,t={}){var r;let s,i;try{let a;let{headers:n,method:o,body:l,signal:c,timeout:u}=t,h={},{region:d}=t;d||(d=this.region);let p=new URL(`${this.url}/${e}`);d&&"any"!==d&&(h["x-region"]=d,p.searchParams.set("forceFunctionRegion",d)),l&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)?"undefined"!=typeof Blob&&l instanceof Blob||l instanceof ArrayBuffer?(h["Content-Type"]="application/octet-stream",a=l):"string"==typeof l?(h["Content-Type"]="text/plain",a=l):"undefined"!=typeof FormData&&l instanceof FormData?a=l:(h["Content-Type"]="application/json",a=JSON.stringify(l)):a=l;let f=c;u&&(i=new AbortController,s=setTimeout(()=>i.abort(),u),c?(f=i.signal,c.addEventListener("abort",()=>i.abort())):f=i.signal);let m=yield this.fetch(p.toString(),{method:o||"POST",headers:Object.assign(Object.assign(Object.assign({},h),this.headers),n),body:a,signal:f}).catch(e=>{throw new F(e)}),g=m.headers.get("x-relay-error");if(g&&"true"===g)throw new V(m);if(!m.ok)throw new W(m);let y=(null!==(r=m.headers.get("Content-Type"))&&void 0!==r?r:"text/plain").split(";")[0].trim();return{data:"application/json"===y?yield m.json():"application/octet-stream"===y||"application/pdf"===y?yield m.blob():"text/event-stream"===y?m:"multipart/form-data"===y?yield m.formData():yield m.text(),error:null,response:m}}catch(e){return{data:null,error:e,response:e instanceof W||e instanceof V?e.context:void 0}}finally{s&&clearTimeout(s)}})}}var H=r(5802),G=r.t(H,2);let{PostgrestClient:J,PostgrestQueryBuilder:z,PostgrestFilterBuilder:Z,PostgrestTransformBuilder:Y,PostgrestBuilder:X,PostgrestError:Q}=H||G;class ee{static detectEnvironment(){var e;if("undefined"!=typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if("undefined"!=typeof global&&void 0!==global.WebSocket)return{type:"native",constructor:global.WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocketPair&&void 0===globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!=typeof globalThis&&globalThis.EdgeRuntime||"undefined"!=typeof navigator&&(null===(e=navigator.userAgent)||void 0===e?void 0:e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if("undefined"!=typeof process){let e=process.versions;if(e&&e.node){let t=parseInt(e.node.replace(/^v/,"").split(".")[0]);return t>=22?void 0!==globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${t} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${t} detected without native WebSocket support.`,workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){let e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),Error(t)}static createWebSocket(e,t){return new(this.getWebSocketConstructor())(e,t)}static isWebSocketSupported(){try{let e=this.detectEnvironment();return"native"===e.type||"ws"===e.type}catch(e){return!1}}}let et="1.0.0";(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(a||(a={})),function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"}(n||(n={})),function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"}(o||(o={})),(l||(l={})).websocket="websocket",function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"}(c||(c={}));class er{constructor(){this.HEADER_LENGTH=1,this.META_LENGTH=4,this.USER_BROADCAST_PUSH_META_LENGTH=5,this.KINDS={push:0,reply:1,broadcast:2,userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST="broadcast"}encode(e,t){return this._isArrayBuffer(e.payload)?t(this._binaryEncodePush(e)):e.event!==this.BROADCAST||e.payload instanceof ArrayBuffer||"string"!=typeof e.payload.event?t(JSON.stringify([e.join_ref,e.ref,e.topic,e.event,e.payload])):t(this._binaryEncodeUserBroadcastPush(e))}_binaryEncodePush(e){let{join_ref:t,ref:r,event:s,topic:i,payload:a}=e,n=this.META_LENGTH+t.length+r.length+i.length+s.length,o=new ArrayBuffer(this.HEADER_LENGTH+n),l=new DataView(o),c=0;l.setUint8(c++,this.KINDS.push),l.setUint8(c++,t.length),l.setUint8(c++,r.length),l.setUint8(c++,i.length),l.setUint8(c++,s.length),Array.from(t,e=>l.setUint8(c++,e.charCodeAt(0))),Array.from(r,e=>l.setUint8(c++,e.charCodeAt(0))),Array.from(i,e=>l.setUint8(c++,e.charCodeAt(0))),Array.from(s,e=>l.setUint8(c++,e.charCodeAt(0)));var u=new Uint8Array(o.byteLength+a.byteLength);return u.set(new Uint8Array(o),0),u.set(new Uint8Array(a),o.byteLength),u.buffer}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer(null===(t=e.payload)||void 0===t?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){let{join_ref:t,ref:r,topic:s}=e,i=e.payload.event,a=null!==(h=null===(u=e.payload)||void 0===u?void 0:u.payload)&&void 0!==h?h:new ArrayBuffer(0),n=this.USER_BROADCAST_PUSH_META_LENGTH+t.length+r.length+s.length+i.length,o=new ArrayBuffer(this.HEADER_LENGTH+n),l=new DataView(o),c=0;l.setUint8(c++,this.KINDS.userBroadcastPush),l.setUint8(c++,t.length),l.setUint8(c++,r.length),l.setUint8(c++,s.length),l.setUint8(c++,i.length),l.setUint8(c++,this.BINARY_ENCODING),Array.from(t,e=>l.setUint8(c++,e.charCodeAt(0))),Array.from(r,e=>l.setUint8(c++,e.charCodeAt(0))),Array.from(s,e=>l.setUint8(c++,e.charCodeAt(0))),Array.from(i,e=>l.setUint8(c++,e.charCodeAt(0)));var u,h,d=new Uint8Array(o.byteLength+a.byteLength);return d.set(new Uint8Array(o),0),d.set(new Uint8Array(a),o.byteLength),d.buffer}_encodeJsonUserBroadcastPush(e){let{join_ref:t,ref:r,topic:s}=e,i=e.payload.event,a=null!==(d=null===(h=e.payload)||void 0===h?void 0:h.payload)&&void 0!==d?d:{},n=new TextEncoder().encode(JSON.stringify(a)).buffer,o=this.USER_BROADCAST_PUSH_META_LENGTH+t.length+r.length+s.length+i.length,l=new ArrayBuffer(this.HEADER_LENGTH+o),c=new DataView(l),u=0;c.setUint8(u++,this.KINDS.userBroadcastPush),c.setUint8(u++,t.length),c.setUint8(u++,r.length),c.setUint8(u++,s.length),c.setUint8(u++,i.length),c.setUint8(u++,this.JSON_ENCODING),Array.from(t,e=>c.setUint8(u++,e.charCodeAt(0))),Array.from(r,e=>c.setUint8(u++,e.charCodeAt(0))),Array.from(s,e=>c.setUint8(u++,e.charCodeAt(0))),Array.from(i,e=>c.setUint8(u++,e.charCodeAt(0)));var h,d,p=new Uint8Array(l.byteLength+n.byteLength);return p.set(new Uint8Array(l),0),p.set(new Uint8Array(n),l.byteLength),p.buffer}decode(e,t){if(this._isArrayBuffer(e))return t(this._binaryDecode(e));if("string"==typeof e){let[r,s,i,a,n]=JSON.parse(e);return t({join_ref:r,ref:s,topic:i,event:a,payload:n})}return t({})}_binaryDecode(e){let t=new DataView(e),r=t.getUint8(0),s=new TextDecoder;switch(r){case this.KINDS.push:return this._decodePush(e,t,s);case this.KINDS.reply:return this._decodeReply(e,t,s);case this.KINDS.broadcast:return this._decodeBroadcast(e,t,s);case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,t,s)}}_decodePush(e,t,r){let s=t.getUint8(1),i=t.getUint8(2),a=t.getUint8(3),n=this.HEADER_LENGTH+this.META_LENGTH-1,o=r.decode(e.slice(n,n+s));n+=s;let l=r.decode(e.slice(n,n+i));n+=i;let c=r.decode(e.slice(n,n+a));return n+=a,{join_ref:o,ref:null,topic:l,event:c,payload:JSON.parse(r.decode(e.slice(n,e.byteLength)))}}_decodeReply(e,t,r){let s=t.getUint8(1),i=t.getUint8(2),a=t.getUint8(3),n=t.getUint8(4),l=this.HEADER_LENGTH+this.META_LENGTH,c=r.decode(e.slice(l,l+s));l+=s;let u=r.decode(e.slice(l,l+i));l+=i;let h=r.decode(e.slice(l,l+a));l+=a;let d=r.decode(e.slice(l,l+n));l+=n;let p=JSON.parse(r.decode(e.slice(l,e.byteLength)));return{join_ref:c,ref:u,topic:h,event:o.reply,payload:{status:d,response:p}}}_decodeBroadcast(e,t,r){let s=t.getUint8(1),i=t.getUint8(2),a=this.HEADER_LENGTH+2,n=r.decode(e.slice(a,a+s));a+=s;let o=r.decode(e.slice(a,a+i));return a+=i,{join_ref:null,ref:null,topic:n,event:o,payload:JSON.parse(r.decode(e.slice(a,e.byteLength)))}}_decodeUserBroadcast(e,t,r){let s=t.getUint8(1),i=t.getUint8(2),a=t.getUint8(3),n=t.getUint8(4),o=this.HEADER_LENGTH+4,l=r.decode(e.slice(o,o+s));o+=s;let c=r.decode(e.slice(o,o+i));o+=i;let u=r.decode(e.slice(o,o+a));o+=a;let h=e.slice(o,e.byteLength),d=n===this.JSON_ENCODING?JSON.parse(r.decode(h)):h,p={type:this.BROADCAST,event:c,payload:d};return a>0&&(p.meta=JSON.parse(u)),{join_ref:null,ref:null,topic:l,event:this.BROADCAST,payload:p}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||(null===(t=null==e?void 0:e.constructor)||void 0===t?void 0:t.name)==="ArrayBuffer"}}class es{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}!function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"}(u||(u={}));let ei=(e,t,r={})=>{var s;let i=null!==(s=r.skipTypes)&&void 0!==s?s:[];return t?Object.keys(t).reduce((r,s)=>(r[s]=ea(s,e,t,i),r),{}):{}},ea=(e,t,r,s)=>{let i=t.find(t=>t.name===e),a=null==i?void 0:i.type,n=r[e];return a&&!s.includes(a)?en(a,n):eo(n)},en=(e,t)=>{if("_"===e.charAt(0))return eh(t,e.slice(1,e.length));switch(e){case u.bool:return el(t);case u.float4:case u.float8:case u.int2:case u.int4:case u.int8:case u.numeric:case u.oid:return ec(t);case u.json:case u.jsonb:return eu(t);case u.timestamp:return ed(t);case u.abstime:case u.date:case u.daterange:case u.int4range:case u.int8range:case u.money:case u.reltime:case u.text:case u.time:case u.timestamptz:case u.timetz:case u.tsrange:case u.tstzrange:default:return eo(t)}},eo=e=>e,el=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},ec=e=>{if("string"==typeof e){let t=parseFloat(e);if(!Number.isNaN(t))return t}return e},eu=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(e){console.log(`JSON parse error: ${e}`)}return e},eh=(e,t)=>{if("string"!=typeof e)return e;let r=e.length-1,s=e[r];if("{"===e[0]&&"}"===s){let s;let i=e.slice(1,r);try{s=JSON.parse("["+i+"]")}catch(e){s=i?i.split(","):[]}return s.map(e=>en(t,e))}return e},ed=e=>"string"==typeof e?e.replace(" ","T"):e,ep=e=>{let t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),""===t.pathname||"/"===t.pathname?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class ef{constructor(e,t,r={},s=1e4){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t(null===(r=this.receivedResp)||void 0===r?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){this.timeoutTimer||(this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref),this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout))}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(t=>t.status===e).forEach(e=>e.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}!function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"}(h||(h={}));class em{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};let r=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},e=>{let{onJoin:t,onLeave:r,onSync:s}=this.caller;this.joinRef=this.channel._joinRef(),this.state=em.syncState(this.state,e,t,r),this.pendingDiffs.forEach(e=>{this.state=em.syncDiff(this.state,e,t,r)}),this.pendingDiffs=[],s()}),this.channel._on(r.diff,{},e=>{let{onJoin:t,onLeave:r,onSync:s}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=em.syncDiff(this.state,e,t,r),s())}),this.onJoin((e,t,r)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:r})}),this.onLeave((e,t,r)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:r})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){let i=this.cloneDeep(e),a=this.transformState(t),n={},o={};return this.map(i,(e,t)=>{a[e]||(o[e]=t)}),this.map(a,(e,t)=>{let r=i[e];if(r){let s=t.map(e=>e.presence_ref),i=r.map(e=>e.presence_ref),a=t.filter(e=>0>i.indexOf(e.presence_ref)),l=r.filter(e=>0>s.indexOf(e.presence_ref));a.length>0&&(n[e]=a),l.length>0&&(o[e]=l)}else n[e]=t}),this.syncDiff(i,{joins:n,leaves:o},r,s)}static syncDiff(e,t,r,s){let{joins:i,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(i,(t,s)=>{var i;let a=null!==(i=e[t])&&void 0!==i?i:[];if(e[t]=this.cloneDeep(s),a.length>0){let r=e[t].map(e=>e.presence_ref),s=a.filter(e=>0>r.indexOf(e.presence_ref));e[t].unshift(...s)}r(t,a,s)}),this.map(a,(t,r)=>{let i=e[t];if(!i)return;let a=r.map(e=>e.presence_ref);i=i.filter(e=>0>a.indexOf(e.presence_ref)),e[t]=i,s(t,i,r),0===i.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return Object.getOwnPropertyNames(e=this.cloneDeep(e)).reduce((t,r)=>{let s=e[r];return"metas"in s?t[r]=s.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):t[r]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(d||(d={})),function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"}(p||(p={})),function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"}(f||(f={}));class eg{constructor(e,t={config:{}},r){var s,i;if(this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=n.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new ef(this,o.join,this.params,this.timeout),this.rejoinTimer=new es(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=n.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=n.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=n.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=n.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=n.errored,this.rejoinTimer.scheduleTimeout())}),this._on(o.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new em(this),this.broadcastEndpointURL=ep(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(null===(i=null===(s=this.params.config)||void 0===s?void 0:s.broadcast)||void 0===i?void 0:i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var r,s,i;if(this.socket.isConnected()||this.socket.connect(),this.state==n.closed){let{config:{broadcast:a,presence:o,private:l}}=this.params,c=null!==(s=null===(r=this.bindings.postgres_changes)||void 0===r?void 0:r.map(e=>e.filter))&&void 0!==s?s:[],u=!!this.bindings[p.PRESENCE]&&this.bindings[p.PRESENCE].length>0||(null===(i=this.params.config.presence)||void 0===i?void 0:i.enabled)===!0,h={},d={broadcast:a,presence:Object.assign(Object.assign({},o),{enabled:u}),postgres_changes:c,private:l};this.socket.accessTokenValue&&(h.access_token=this.socket.accessTokenValue),this._onError(t=>null==e?void 0:e(f.CHANNEL_ERROR,t)),this._onClose(()=>null==e?void 0:e(f.CLOSED)),this.updateJoinPayload(Object.assign({config:d},h)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:t})=>{var r;if(this.socket.setAuth(),void 0===t){null==e||e(f.SUBSCRIBED);return}{let s=this.bindings.postgres_changes,i=null!==(r=null==s?void 0:s.length)&&void 0!==r?r:0,a=[];for(let r=0;r<i;r++){let i=s[r],{filter:{event:o,schema:l,table:c,filter:u}}=i,h=t&&t[r];if(h&&h.event===o&&h.schema===l&&h.table===c&&h.filter===u)a.push(Object.assign(Object.assign({},i),{id:h.id}));else{this.unsubscribe(),this.state=n.errored,null==e||e(f.CHANNEL_ERROR,Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=a,e&&e(f.SUBSCRIBED);return}}).receive("error",t=>{this.state=n.errored,null==e||e(f.CHANNEL_ERROR,Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{null==e||e(f.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this.state===n.joined&&e===p.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,r)}async httpSend(e,t,r={}){var s;let i=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(null==t)return Promise.reject("Payload is required for httpSend()");let a={method:"POST",headers:{Authorization:i,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},n=await this._fetchWithTimeout(this.broadcastEndpointURL,a,null!==(s=r.timeout)&&void 0!==s?s:this.timeout);if(202===n.status)return{success:!0};let o=n.statusText;try{let e=await n.json();o=e.error||e.message||o}catch(e){}return Promise.reject(Error(o))}async send(e,t={}){var r,s;if(this._canPush()||"broadcast"!==e.type)return new Promise(r=>{var s,i,a;let n=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(a=null===(i=null===(s=this.params)||void 0===s?void 0:s.config)||void 0===i?void 0:i.broadcast)||void 0===a?void 0:a.ack)||r("ok"),n.receive("ok",()=>r("ok")),n.receive("error",()=>r("error")),n.receive("timeout",()=>r("timed out"))});{console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");let{event:i,payload:a}=e,n={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:a,private:this.private}]})};try{let e=await this._fetchWithTimeout(this.broadcastEndpointURL,n,null!==(r=t.timeout)&&void 0!==r?r:this.timeout);return await (null===(s=e.body)||void 0===s?void 0:s.cancel()),e.ok?"ok":"error"}catch(e){if("AbortError"===e.name)return"timed out";return"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=n.leaving;let t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(o.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(s=>{(r=new ef(this,o.leave,{},e)).receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{null==r||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=n.closed,this.bindings={}}async _fetchWithTimeout(e,t,r){let s=new AbortController,i=setTimeout(()=>s.abort(),r),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(i),a}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new ef(this,e,t,r);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>100){let e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${e.event}`,e.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,i;let a=e.toLocaleLowerCase(),{close:n,error:l,leave:c,join:u}=o;if(r&&[n,l,c,u].indexOf(a)>=0&&r!==this._joinRef())return;let h=this._onMessage(a,t,r);if(t&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?null===(s=this.bindings.postgres_changes)||void 0===s||s.filter(e=>{var t,r,s;return(null===(t=e.filter)||void 0===t?void 0:t.event)==="*"||(null===(s=null===(r=e.filter)||void 0===r?void 0:r.event)||void 0===s?void 0:s.toLocaleLowerCase())===a}).map(e=>e.callback(h,r)):null===(i=this.bindings[a])||void 0===i||i.filter(e=>{var r,s,i,n,o,l;if(!["broadcast","presence","postgres_changes"].includes(a))return e.type.toLocaleLowerCase()===a;if("id"in e){let a=e.id,n=null===(r=e.filter)||void 0===r?void 0:r.event;return a&&(null===(s=t.ids)||void 0===s?void 0:s.includes(a))&&("*"===n||(null==n?void 0:n.toLocaleLowerCase())===(null===(i=t.data)||void 0===i?void 0:i.type.toLocaleLowerCase()))}{let r=null===(o=null===(n=null==e?void 0:e.filter)||void 0===n?void 0:n.event)||void 0===o?void 0:o.toLocaleLowerCase();return"*"===r||r===(null===(l=null==t?void 0:t.event)||void 0===l?void 0:l.toLocaleLowerCase())}}).map(e=>{if("object"==typeof h&&"ids"in h){let e=h.data,{schema:t,table:r,commit_timestamp:s,type:i,errors:a}=e;h=Object.assign(Object.assign({},{schema:t,table:r,commit_timestamp:s,eventType:i,new:{},old:{},errors:a}),this._getPayloadRecords(e))}e.callback(h,r)})}_isClosed(){return this.state===n.closed}_isJoined(){return this.state===n.joined}_isJoining(){return this.state===n.joining}_isLeaving(){return this.state===n.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){let s=e.toLocaleLowerCase(),i={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,t){let r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(e=>{var s;return!((null===(s=e.type)||void 0===s?void 0:s.toLocaleLowerCase())===r&&eg.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(o.close,{},e)}_onError(e){this._on(o.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=n.joining,this.joinPush.resend(e))}_getPayloadRecords(e){let t={new:{},old:{}};return("INSERT"===e.type||"UPDATE"===e.type)&&(t.new=ei(e.columns,e.record)),("UPDATE"===e.type||"DELETE"===e.type)&&(t.old=ei(e.columns,e.old_record)),t}}let ey=()=>{},eb={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},ev=[1e3,2e3,5e3,1e4],ew=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class e_{constructor(e,t){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=1e4,this.transport=null,this.heartbeatIntervalMs=eb.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=ey,this.ref=0,this.reconnectTimer=null,this.vsn=et,this.logger=ey,this.conn=null,this.sendBuffer=[],this.serializer=new er,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),!(null===(r=null==t?void 0:t.params)||void 0===r?void 0:r.apikey))throw Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${l.websocket}`,this.httpEndpoint=ep(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(null==t?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=ee.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");let e=t.message;if(e.includes("Node.js"))throw Error(`${e}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`);throw Error(`WebSocket not available: ${e}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting()){if(this._setConnectionState("disconnecting",!0),this.conn){let r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},"function"==typeof this.conn.close&&(e?this.conn.close(e,null!=t?t:""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}}getChannels(){return this.channels}async removeChannel(e){let t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){let e=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case a.connecting:return c.Connecting;case a.open:return c.Open;case a.closing:return c.Closing;default:return c.Closed}}isConnected(){return this.connectionState()===c.Open}isConnecting(){return"connecting"===this._connectionState}isDisconnecting(){return"disconnecting"===this._connectionState}channel(e,t={config:{}}){let r=`realtime:${e}`,s=this.getChannels().find(e=>e.topic===r);if(s)return s;{let r=new eg(`realtime:${e}`,t,this);return this.channels.push(r),r}}push(e){let{topic:t,event:r,payload:s,ref:i}=e,a=()=>{this.encode(e,e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)})};this.log("push",`${t} ${r} (${i})`,s),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(e){this.log("error","error in heartbeat callback",e)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(e){this.log("error","error in heartbeat callback",e)}this._wasManualDisconnect=!1,null===(e=this.conn)||void 0===e||e.close(1e3,"heartbeat timeout"),setTimeout(()=>{var e;this.isConnected()||null===(e=this.reconnectTimer)||void 0===e||e.scheduleTimeout()},eb.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(e){this.log("error","error in heartbeat callback",e)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,e=>{if("phoenix"===e.topic&&"phx_reply"===e.event)try{this.heartbeatCallback("ok"===e.payload.status?"ok":"error")}catch(e){this.log("error","error in heartbeat callback",e)}e.ref&&e.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);let{topic:t,event:r,payload:s,ref:i}=e,a=i?`(${i})`:"",n=s.status||"";this.log("receive",`${n} ${t} ${r} ${a}`.trim(),s),this.channels.filter(e=>e._isMember(t)).forEach(e=>e._trigger(r,s,i)),this._triggerStateCallbacks("message",e)})}_clearTimer(e){var t;"heartbeat"===e&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===e&&(null===(t=this.reconnectTimer)||void 0===t||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){if(this.conn){if(this.conn.readyState===a.open||this.conn.readyState===a.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(e=>{this.log("error","error waiting for auth on connect",e),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");let e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||null===(t=this.reconnectTimer)||void 0===t||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(o.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;let r=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${r}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{let e=new Blob([ew],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}_setConnectionState(e,t=!1){this._connectionState=e,"connecting"===e?this._wasManualDisconnect=!1:"disconnecting"===e&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;t=e||(this.accessToken?await this.accessToken():this.accessTokenValue),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(e=>{t&&e.updateJoinPayload({access_token:t,version:"realtime-js/2.81.1"}),e.joinedOnce&&e._isJoined()&&e._push(o.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(t){this.log("error",`error in ${e} callback`,t)}})}catch(t){this.log("error",`error triggering ${e} callbacks`,t)}}_setupReconnectionTimer(){this.reconnectTimer=new es(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},eb.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,r,s,i,a,n,o,l,c,u,h,d;switch(this.transport=null!==(t=null==e?void 0:e.transport)&&void 0!==t?t:null,this.timeout=null!==(r=null==e?void 0:e.timeout)&&void 0!==r?r:1e4,this.heartbeatIntervalMs=null!==(s=null==e?void 0:e.heartbeatIntervalMs)&&void 0!==s?s:eb.HEARTBEAT_INTERVAL,this.worker=null!==(i=null==e?void 0:e.worker)&&void 0!==i&&i,this.accessToken=null!==(a=null==e?void 0:e.accessToken)&&void 0!==a?a:null,this.heartbeatCallback=null!==(n=null==e?void 0:e.heartbeatCallback)&&void 0!==n?n:ey,this.vsn=null!==(o=null==e?void 0:e.vsn)&&void 0!==o?o:et,(null==e?void 0:e.params)&&(this.params=e.params),(null==e?void 0:e.logger)&&(this.logger=e.logger),((null==e?void 0:e.logLevel)||(null==e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!==(l=null==e?void 0:e.reconnectAfterMs)&&void 0!==l?l:e=>ev[e-1]||1e4,this.vsn){case et:this.encode=null!==(c=null==e?void 0:e.encode)&&void 0!==c?c:(e,t)=>t(JSON.stringify(e)),this.decode=null!==(u=null==e?void 0:e.decode)&&void 0!==u?u:(e,t)=>t(JSON.parse(e));break;case"2.0.0":this.encode=null!==(h=null==e?void 0:e.encode)&&void 0!==h?h:this.serializer.encode.bind(this.serializer),this.decode=null!==(d=null==e?void 0:e.decode)&&void 0!==d?d:this.serializer.decode.bind(this.serializer);break;default:throw Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if("undefined"!=typeof window&&!window.Worker)throw Error("Web Worker is not supported");this.workerUrl=null==e?void 0:e.workerUrl}}}class ex extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function ek(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}class ej extends ex{constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class eS extends ex{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}let eE=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),eT=()=>Response,eO=e=>{if(Array.isArray(e))return e.map(e=>eO(e));if("function"==typeof e||e!==Object(e))return e;let t={};return Object.entries(e).forEach(([e,r])=>{t[e.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""))]=eO(r)}),t},eN=e=>{if("object"!=typeof e||null===e)return!1;let t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},eC=e=>{var t;return e.msg||e.message||e.error_description||("string"==typeof e.error?e.error:null===(t=e.error)||void 0===t?void 0:t.message)||JSON.stringify(e)},eA=(e,t,r)=>(0,B.__awaiter)(void 0,void 0,void 0,function*(){e instanceof(yield eT())&&!(null==r?void 0:r.noResolveJson)?e.json().then(r=>{let s=e.status||500,i=(null==r?void 0:r.statusCode)||s+"";t(new ej(eC(r),s,i))}).catch(e=>{t(new eS(eC(e),e))}):t(new eS(eC(e),e))}),eR=(e,t,r,s)=>{let i={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"!==e&&s?(eN(s)?(i.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),i.body=JSON.stringify(s)):i.body=s,(null==t?void 0:t.duplex)&&(i.duplex=t.duplex),Object.assign(Object.assign({},i),r)):i};function eI(e,t,r,s,i,a){return(0,B.__awaiter)(this,void 0,void 0,function*(){return new Promise((n,o)=>{e(r,eR(t,s,i,a)).then(e=>{if(!e.ok)throw e;return(null==s?void 0:s.noResolveJson)?e:e.json()}).then(e=>n(e)).catch(e=>eA(e,o,s))})})}function eP(e,t,r,s){return(0,B.__awaiter)(this,void 0,void 0,function*(){return eI(e,"GET",t,r,s)})}function e$(e,t,r,s,i){return(0,B.__awaiter)(this,void 0,void 0,function*(){return eI(e,"POST",t,s,i,r)})}function eU(e,t,r,s,i){return(0,B.__awaiter)(this,void 0,void 0,function*(){return eI(e,"PUT",t,s,i,r)})}function eD(e,t,r,s,i){return(0,B.__awaiter)(this,void 0,void 0,function*(){return eI(e,"DELETE",t,s,i,r)})}class eL{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}execute(){return(0,B.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ek(e))return{data:null,error:e};throw e}})}}class eB{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[m]="BlobDownloadBuilder",this.promise=null}asStream(){return new eL(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return(0,B.__awaiter)(this,void 0,void 0,function*(){try{let e=yield this.downloadFn();return{data:yield e.blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ek(e))return{data:null,error:e};throw e}})}}m=Symbol.toStringTag;let eq={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},eM={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class eF{constructor(e,t={},r,s){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=r,this.fetch=eE(s)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,r,s){return(0,B.__awaiter)(this,void 0,void 0,function*(){try{let i;let a=Object.assign(Object.assign({},eM),s),n=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(a.upsert)}),o=a.metadata;"undefined"!=typeof Blob&&r instanceof Blob?((i=new FormData).append("cacheControl",a.cacheControl),o&&i.append("metadata",this.encodeMetadata(o)),i.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?((i=r).has("cacheControl")||i.append("cacheControl",a.cacheControl),o&&!i.has("metadata")&&i.append("metadata",this.encodeMetadata(o))):(i=r,n["cache-control"]=`max-age=${a.cacheControl}`,n["content-type"]=a.contentType,o&&(n["x-metadata"]=this.toBase64(this.encodeMetadata(o))),("undefined"!=typeof ReadableStream&&i instanceof ReadableStream||i&&"object"==typeof i&&"pipe"in i&&"function"==typeof i.pipe)&&!a.duplex&&(a.duplex="half")),(null==s?void 0:s.headers)&&(n=Object.assign(Object.assign({},n),s.headers));let l=this._removeEmptyFolders(t),c=this._getFinalPath(l),u=yield("PUT"==e?eU:e$)(this.fetch,`${this.url}/object/${c}`,i,Object.assign({headers:n},(null==a?void 0:a.duplex)?{duplex:a.duplex}:{}));return{data:{path:l,id:u.Id,fullPath:u.Key},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ek(e))return{data:null,error:e};throw e}})}upload(e,t,r){return(0,B.__awaiter)(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,s){return(0,B.__awaiter)(this,void 0,void 0,function*(){let i=this._removeEmptyFolders(e),a=this._getFinalPath(i),n=new URL(this.url+`/object/upload/sign/${a}`);n.searchParams.set("token",t);try{let e;let t=Object.assign({upsert:eM.upsert},s),a=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!=typeof Blob&&r instanceof Blob?((e=new FormData).append("cacheControl",t.cacheControl),e.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(e=r).append("cacheControl",t.cacheControl):(e=r,a["cache-control"]=`max-age=${t.cacheControl}`,a["content-type"]=t.contentType);let o=yield eU(this.fetch,n.toString(),e,{headers:a});return{data:{path:i,fullPath:o.Key},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ek(e))return{data:null,error:e};throw e}})}createSignedUploadUrl(e,t){return(0,B.__awaiter)(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e),s=Object.assign({},this.headers);(null==t?void 0:t.upsert)&&(s["x-upsert"]="true");let i=yield e$(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:s}),a=new URL(this.url+i.url),n=a.searchParams.get("token");if(!n)throw new ex("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:n},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ek(e))return{data:null,error:e};throw e}})}update(e,t,r){return(0,B.__awaiter)(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return(0,B.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield e$(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==r?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ek(e))return{data:null,error:e};throw e}})}copy(e,t,r){return(0,B.__awaiter)(this,void 0,void 0,function*(){try{return{data:{path:(yield e$(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==r?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ek(e))return{data:null,error:e};throw e}})}createSignedUrl(e,t,r){return(0,B.__awaiter)(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),i=yield e$(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},(null==r?void 0:r.transform)?{transform:r.transform}:{}),{headers:this.headers}),a=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return{data:i={signedUrl:encodeURI(`${this.url}${i.signedURL}${a}`)},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ek(e))return{data:null,error:e};throw e}})}createSignedUrls(e,t,r){return(0,B.__awaiter)(this,void 0,void 0,function*(){try{let s=yield e$(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return{data:s.map(e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI(`${this.url}${e.signedURL}${i}`):null})),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ek(e))return{data:null,error:e};throw e}})}download(e,t){let r=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",s=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),i=s?`?${s}`:"",a=this._getFinalPath(e);return new eB(()=>eP(this.fetch,`${this.url}/${r}/${a}${i}`,{headers:this.headers,noResolveJson:!0}),this.shouldThrowOnError)}info(e){return(0,B.__awaiter)(this,void 0,void 0,function*(){let t=this._getFinalPath(e);try{let e=yield eP(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:eO(e),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ek(e))return{data:null,error:e};throw e}})}exists(e){return(0,B.__awaiter)(this,void 0,void 0,function*(){let t=this._getFinalPath(e);try{return yield function(e,t,r,s){return(0,B.__awaiter)(this,void 0,void 0,function*(){return eI(e,"HEAD",t,Object.assign(Object.assign({},r),{noResolveJson:!0}),void 0)})}(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ek(e)&&e instanceof eS){let t=e.originalError;if([400,404].includes(null==t?void 0:t.status))return{data:!1,error:e}}throw e}})}getPublicUrl(e,t){let r=this._getFinalPath(e),s=[],i=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==i&&s.push(i);let a=void 0!==(null==t?void 0:t.transform),n=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==n&&s.push(n);let o=s.join("&");return""!==o&&(o=`?${o}`),{data:{publicUrl:encodeURI(`${this.url}/${a?"render/image":"object"}/public/${r}${o}`)}}}remove(e){return(0,B.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield eD(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ek(e))return{data:null,error:e};throw e}})}list(e,t,r){return(0,B.__awaiter)(this,void 0,void 0,function*(){try{let s=Object.assign(Object.assign(Object.assign({},eq),t),{prefix:e||""});return{data:yield e$(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ek(e))return{data:null,error:e};throw e}})}listV2(e,t){return(0,B.__awaiter)(this,void 0,void 0,function*(){try{let r=Object.assign({},e);return{data:yield e$(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},t),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ek(e))return{data:null,error:e};throw e}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){let t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}let eV="2.81.1",eW={"X-Client-Info":`storage-js/${eV}`};class eK{constructor(e,t={},r,s){this.shouldThrowOnError=!1;let i=new URL(e);(null==s?void 0:s.useNewHostname)&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase.")),this.url=i.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},eW),t),this.fetch=eE(r)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(e){return(0,B.__awaiter)(this,void 0,void 0,function*(){try{let t=this.listBucketOptionsToQueryString(e);return{data:yield eP(this.fetch,`${this.url}/bucket${t}`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ek(e))return{data:null,error:e};throw e}})}getBucket(e){return(0,B.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield eP(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ek(e))return{data:null,error:e};throw e}})}createBucket(e){return(0,B.__awaiter)(this,arguments,void 0,function*(e,t={public:!1}){try{return{data:yield e$(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ek(e))return{data:null,error:e};throw e}})}updateBucket(e,t){return(0,B.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield eU(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ek(e))return{data:null,error:e};throw e}})}emptyBucket(e){return(0,B.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield e$(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ek(e))return{data:null,error:e};throw e}})}deleteBucket(e){return(0,B.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield eD(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ek(e))return{data:null,error:e};throw e}})}listBucketOptionsToQueryString(e){let t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}}class eH{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},eW),t),this.fetch=eE(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return(0,B.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield e$(this.fetch,`${this.url}/bucket`,{name:e},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ek(e))return{data:null,error:e};throw e}})}listBuckets(e){return(0,B.__awaiter)(this,void 0,void 0,function*(){try{let t=new URLSearchParams;(null==e?void 0:e.limit)!==void 0&&t.set("limit",e.limit.toString()),(null==e?void 0:e.offset)!==void 0&&t.set("offset",e.offset.toString()),(null==e?void 0:e.sortColumn)&&t.set("sortColumn",e.sortColumn),(null==e?void 0:e.sortOrder)&&t.set("sortOrder",e.sortOrder),(null==e?void 0:e.search)&&t.set("search",e.search);let r=t.toString(),s=r?`${this.url}/bucket?${r}`:`${this.url}/bucket`;return{data:yield eP(this.fetch,s,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ek(e))return{data:null,error:e};throw e}})}deleteBucket(e){return(0,B.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield eD(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ek(e))return{data:null,error:e};throw e}})}}let eG={"X-Client-Info":`storage-js/${eV}`,"Content-Type":"application/json"};class eJ extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function ez(e){return"object"==typeof e&&null!==e&&"__isStorageVectorsError"in e}class eZ extends eJ{constructor(e,t,r){super(e),this.name="StorageVectorsApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class eY extends eJ{constructor(e,t){super(e),this.name="StorageVectorsUnknownError",this.originalError=t}}!function(e){e.InternalError="InternalError",e.S3VectorConflictException="S3VectorConflictException",e.S3VectorNotFoundException="S3VectorNotFoundException",e.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",e.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",e.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"}(g||(g={}));let eX=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),eQ=e=>{if("object"!=typeof e||null===e)return!1;let t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},e0=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),e1=(e,t,r)=>(0,B.__awaiter)(void 0,void 0,void 0,function*(){if(!(e&&"object"==typeof e&&"status"in e&&"ok"in e&&"number"==typeof e.status)||(null==r?void 0:r.noResolveJson))t(new eY(e0(e),e));else{let r=e.status||500;"function"==typeof e.json?e.json().then(e=>{let s=(null==e?void 0:e.statusCode)||(null==e?void 0:e.code)||r+"";t(new eZ(e0(e),r,s))}).catch(()=>{t(new eZ(e.statusText||`HTTP ${r} error`,r,r+""))}):t(new eZ(e.statusText||`HTTP ${r} error`,r,r+""))}}),e2=(e,t,r,s)=>{let i={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"!==e&&s?(eQ(s)?(i.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),i.body=JSON.stringify(s)):i.body=s,Object.assign(Object.assign({},i),r)):i};function e5(e,t,r,s,i){return(0,B.__awaiter)(this,void 0,void 0,function*(){return function(e,t,r,s,i,a){return(0,B.__awaiter)(this,void 0,void 0,function*(){return new Promise((n,o)=>{e(r,e2(t,s,i,a)).then(e=>{if(!e.ok)throw e;if(null==s?void 0:s.noResolveJson)return e;let t=e.headers.get("content-type");return t&&t.includes("application/json")?e.json():{}}).then(e=>n(e)).catch(e=>e1(e,o,s))})})}(e,"POST",t,s,i,r)})}class e3{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},eG),t),this.fetch=eX(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(e){return(0,B.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield e5(this.fetch,`${this.url}/CreateIndex`,e,{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ez(e))return{data:null,error:e};throw e}})}getIndex(e,t){return(0,B.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield e5(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ez(e))return{data:null,error:e};throw e}})}listIndexes(e){return(0,B.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield e5(this.fetch,`${this.url}/ListIndexes`,e,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ez(e))return{data:null,error:e};throw e}})}deleteIndex(e,t){return(0,B.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield e5(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ez(e))return{data:null,error:e};throw e}})}}class e8{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},eG),t),this.fetch=eX(r)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(e){return(0,B.__awaiter)(this,void 0,void 0,function*(){try{if(e.vectors.length<1||e.vectors.length>500)throw Error("Vector batch size must be between 1 and 500 items");return{data:(yield e5(this.fetch,`${this.url}/PutVectors`,e,{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ez(e))return{data:null,error:e};throw e}})}getVectors(e){return(0,B.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield e5(this.fetch,`${this.url}/GetVectors`,e,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ez(e))return{data:null,error:e};throw e}})}listVectors(e){return(0,B.__awaiter)(this,void 0,void 0,function*(){try{if(void 0!==e.segmentCount){if(e.segmentCount<1||e.segmentCount>16)throw Error("segmentCount must be between 1 and 16");if(void 0!==e.segmentIndex&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return{data:yield e5(this.fetch,`${this.url}/ListVectors`,e,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ez(e))return{data:null,error:e};throw e}})}queryVectors(e){return(0,B.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield e5(this.fetch,`${this.url}/QueryVectors`,e,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ez(e))return{data:null,error:e};throw e}})}deleteVectors(e){return(0,B.__awaiter)(this,void 0,void 0,function*(){try{if(e.keys.length<1||e.keys.length>500)throw Error("Keys batch size must be between 1 and 500 items");return{data:(yield e5(this.fetch,`${this.url}/DeleteVectors`,e,{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ez(e))return{data:null,error:e};throw e}})}}class e4{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},eG),t),this.fetch=eX(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return(0,B.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield e5(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ez(e))return{data:null,error:e};throw e}})}getBucket(e){return(0,B.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield e5(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:e},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ez(e))return{data:null,error:e};throw e}})}listBuckets(){return(0,B.__awaiter)(this,arguments,void 0,function*(e={}){try{return{data:yield e5(this.fetch,`${this.url}/ListVectorBuckets`,e,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ez(e))return{data:null,error:e};throw e}})}deleteBucket(e){return(0,B.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield e5(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ez(e))return{data:null,error:e};throw e}})}}class e6 extends e4{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new e9(this.url,this.headers,e,this.fetch)}}class e9 extends e3{constructor(e,t,r,s){super(e,t,s),this.vectorBucketName=r}createIndex(e){let t=Object.create(null,{createIndex:{get:()=>super.createIndex}});return(0,B.__awaiter)(this,void 0,void 0,function*(){return t.createIndex.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){let e=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return(0,B.__awaiter)(this,arguments,void 0,function*(t={}){return e.listIndexes.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName}))})}getIndex(e){let t=Object.create(null,{getIndex:{get:()=>super.getIndex}});return(0,B.__awaiter)(this,void 0,void 0,function*(){return t.getIndex.call(this,this.vectorBucketName,e)})}deleteIndex(e){let t=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return(0,B.__awaiter)(this,void 0,void 0,function*(){return t.deleteIndex.call(this,this.vectorBucketName,e)})}index(e){return new e7(this.url,this.headers,this.vectorBucketName,e,this.fetch)}}class e7 extends e8{constructor(e,t,r,s,i){super(e,t,i),this.vectorBucketName=r,this.indexName=s}putVectors(e){let t=Object.create(null,{putVectors:{get:()=>super.putVectors}});return(0,B.__awaiter)(this,void 0,void 0,function*(){return t.putVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(e){let t=Object.create(null,{getVectors:{get:()=>super.getVectors}});return(0,B.__awaiter)(this,void 0,void 0,function*(){return t.getVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){let e=Object.create(null,{listVectors:{get:()=>super.listVectors}});return(0,B.__awaiter)(this,arguments,void 0,function*(t={}){return e.listVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(e){let t=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return(0,B.__awaiter)(this,void 0,void 0,function*(){return t.queryVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(e){let t=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return(0,B.__awaiter)(this,void 0,void 0,function*(){return t.deleteVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class te extends eK{constructor(e,t={},r,s){super(e,t,r,s)}from(e){return new eF(this.url,this.headers,e,this.fetch)}get vectors(){return new e6(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new eH(this.url+"/iceberg",this.headers,this.fetch)}}let tt="";"undefined"!=typeof Deno?tt="deno":"undefined"!=typeof document?tt="web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?tt="react-native":tt="node";let tr={headers:{"X-Client-Info":`supabase-js-${tt}/2.81.1`}},ts={schema:"public"},ti={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},ta={},tn=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),to=()=>Headers,tl=(e,t,r)=>{let s=tn(r),i=to();return async(r,a)=>{var n;let o=null!==(n=await t())&&void 0!==n?n:e,l=new i(null==a?void 0:a.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${o}`),s(r,Object.assign(Object.assign({},a),{headers:l}))}},tc="2.81.1",tu={"X-Client-Info":`gotrue-js/${tc}`},th="X-Supabase-Api-Version",td={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},tp=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class tf extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function tm(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class tg extends tf{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}class ty extends tf{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class tb extends tf{constructor(e,t,r,s){super(e,r,s),this.name=t,this.status=r}}class tv extends tb{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class tw extends tb{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class t_ extends tb{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class tx extends tb{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class tk extends tb{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class tj extends tb{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function tS(e){return tm(e)&&"AuthRetryableFetchError"===e.name}class tE extends tb{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class tT extends tb{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}let tO="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),tN=" 	\n\r=".split(""),tC=(()=>{let e=Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<tN.length;t+=1)e[tN[t].charCodeAt(0)]=-2;for(let t=0;t<tO.length;t+=1)e[tO[t].charCodeAt(0)]=t;return e})();function tA(e,t,r){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;)r(tO[t.queue>>t.queuedBits-6&63]),t.queuedBits-=6;else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;)r(tO[t.queue>>t.queuedBits-6&63]),t.queuedBits-=6}function tR(e,t,r){let s=tC[e];if(s>-1)for(t.queue=t.queue<<6|s,t.queuedBits+=6;t.queuedBits>=8;)r(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else if(-2===s)return;else throw Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}function tI(e){let t=[],r=e=>{t.push(String.fromCodePoint(e))},s={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},a=e=>{(function(e,t,r){if(0===t.utf8seq){if(e<=127){r(e);return}for(let r=1;r<6;r+=1)if((e>>7-r&1)==0){t.utf8seq=r;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else if(4===t.utf8seq)t.codepoint=7&e;else throw Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&r(t.codepoint)}})(e,s,r)};for(let t=0;t<e.length;t+=1)tR(e.charCodeAt(t),i,a);return t.join("")}function tP(e){let t=[],r={queue:0,queuedBits:0},s=e=>{t.push(e)};for(let t=0;t<e.length;t+=1)tR(e.charCodeAt(t),r,s);return new Uint8Array(t)}function t$(e){let t=[],r={queue:0,queuedBits:0},s=e=>{t.push(e)};return e.forEach(e=>tA(e,r,s)),tA(null,r,s),t.join("")}let tU=()=>"undefined"!=typeof window&&"undefined"!=typeof document,tD={tested:!1,writable:!1},tL=()=>{if(!tU())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(e){return!1}if(tD.tested)return tD.writable;let e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),tD.tested=!0,tD.writable=!0}catch(e){tD.tested=!0,tD.writable=!1}return tD.writable},tB=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),tq=e=>"object"==typeof e&&null!==e&&"status"in e&&"ok"in e&&"json"in e&&"function"==typeof e.json,tM=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},tF=async(e,t)=>{let r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch(e){return r}},tV=async(e,t)=>{await e.removeItem(t)};class tW{constructor(){this.promise=new tW.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function tK(e){let t=e.split(".");if(3!==t.length)throw new tT("Invalid JWT structure");for(let e=0;e<t.length;e++)if(!tp.test(t[e]))throw new tT("JWT not in base64url format");return{header:JSON.parse(tI(t[0])),payload:JSON.parse(tI(t[1])),signature:tP(t[2]),raw:{header:t[0],payload:t[1]}}}async function tH(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function tG(e){return("0"+e.toString(16)).substr(-2)}async function tJ(e){let t=new TextEncoder().encode(e);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>String.fromCharCode(e)).join("")}async function tz(e){return"undefined"!=typeof crypto&&void 0!==crypto.subtle&&"undefined"!=typeof TextEncoder?btoa(await tJ(e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""):(console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e)}async function tZ(e,t,r=!1){let s=function(){let e=new Uint32Array(56);if("undefined"==typeof crypto){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length,r="";for(let s=0;s<56;s++)r+=e.charAt(Math.floor(Math.random()*t));return r}return crypto.getRandomValues(e),Array.from(e,tG).join("")}(),i=s;r&&(i+="/PASSWORD_RECOVERY"),await tM(e,`${t}-code-verifier`,i);let a=await tz(s),n=s===a?"plain":"s256";return[a,n]}tW.promiseConstructor=Promise;let tY=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i,tX=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function tQ(e){if(!tX.test(e))throw Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function t0(){return new Proxy({},{get:(e,t)=>{if("__isUserNotAvailableProxy"===t)return!0;if("symbol"==typeof t){let e=t.toString();if("Symbol(Symbol.toPrimitive)"===e||"Symbol(Symbol.toStringTag)"===e||"Symbol(util.inspect.custom)"===e)return}throw Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function t1(e){return JSON.parse(JSON.stringify(e))}let t2=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),t5=[502,503,504];async function t3(e){var t;let r,s;if(!tq(e))throw new tj(t2(e),0);if(t5.includes(e.status))throw new tj(t2(e),e.status);try{r=await e.json()}catch(e){throw new ty(t2(e),e)}let i=function(e){let t=e.headers.get(th);if(!t||!t.match(tY))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(e){return null}}(e);if(i&&i.getTime()>=td["2024-01-01"].timestamp&&"object"==typeof r&&r&&"string"==typeof r.code?s=r.code:"object"==typeof r&&r&&"string"==typeof r.error_code&&(s=r.error_code),s){if("weak_password"===s)throw new tE(t2(r),e.status,(null===(t=r.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===s)throw new tv}else if("object"==typeof r&&r&&"object"==typeof r.weak_password&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0))throw new tE(t2(r),e.status,r.weak_password.reasons);throw new tg(t2(r),e.status||500,s)}let t8=(e,t,r,s)=>{let i={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),i.body=JSON.stringify(s),Object.assign(Object.assign({},i),r))};async function t4(e,t,r,s){var i;let a=Object.assign({},null==s?void 0:s.headers);a[th]||(a[th]=td["2024-01-01"].name),(null==s?void 0:s.jwt)&&(a.Authorization=`Bearer ${s.jwt}`);let n=null!==(i=null==s?void 0:s.query)&&void 0!==i?i:{};(null==s?void 0:s.redirectTo)&&(n.redirect_to=s.redirectTo);let o=Object.keys(n).length?"?"+new URLSearchParams(n).toString():"",l=await t6(e,t,r+o,{headers:a,noResolveJson:null==s?void 0:s.noResolveJson},{},null==s?void 0:s.body);return(null==s?void 0:s.xform)?null==s?void 0:s.xform(l):{data:Object.assign({},l),error:null}}async function t6(e,t,r,s,i,a){let n;let o=t8(t,s,i,a);try{n=await e(r,Object.assign({},o))}catch(e){throw console.error(e),new tj(t2(e),0)}if(n.ok||await t3(n),null==s?void 0:s.noResolveJson)return n;try{return await n.json()}catch(e){await t3(e)}}function t9(e){var t,r;let s=null;return e.access_token&&e.refresh_token&&e.expires_in&&(s=Object.assign({},e),!e.expires_at)&&(s.expires_at=(r=e.expires_in,Math.round(Date.now()/1e3)+r)),{data:{session:s,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function t7(e){let t=t9(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0)&&(t.data.weak_password=e.weak_password),t}function re(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function rt(e){return{data:e,error:null}}function rr(e){let{action_link:t,email_otp:r,hashed_token:s,redirect_to:i,verification_type:a}=e;return{data:{properties:{action_link:t,email_otp:r,hashed_token:s,redirect_to:i,verification_type:a},user:Object.assign({},(0,B.__rest)(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]))},error:null}}function rs(e){return e}let ri=["global","local","others"];class ra{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=tB(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=ri[0]){if(0>ri.indexOf(t))throw Error(`@supabase/auth-js: Parameter scope must be one of ${ri.join(", ")}`);try{return await t4(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(e){if(tm(e))return{data:null,error:e};throw e}}async inviteUserByEmail(e,t={}){try{return await t4(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:re})}catch(e){if(tm(e))return{data:{user:null},error:e};throw e}}async generateLink(e){try{let{options:t}=e,r=(0,B.__rest)(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=null==r?void 0:r.newEmail,delete s.newEmail),await t4(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:rr,redirectTo:null==t?void 0:t.redirectTo})}catch(e){if(tm(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(e){try{return await t4(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:re})}catch(e){if(tm(e))return{data:{user:null},error:e};throw e}}async listUsers(e){var t,r,s,i,a,n,o;try{let l={nextPage:null,lastPage:0,total:0},c=await t4(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(r=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==r?r:"",per_page:null!==(i=null===(s=null==e?void 0:e.perPage)||void 0===s?void 0:s.toString())&&void 0!==i?i:""},xform:rs});if(c.error)throw c.error;let u=await c.json(),h=null!==(a=c.headers.get("x-total-count"))&&void 0!==a?a:0,d=null!==(o=null===(n=c.headers.get("link"))||void 0===n?void 0:n.split(","))&&void 0!==o?o:[];return d.length>0&&(d.forEach(e=>{let t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(e.split(";")[1].split("=")[1]);l[`${r}Page`]=t}),l.total=parseInt(h)),{data:Object.assign(Object.assign({},u),l),error:null}}catch(e){if(tm(e))return{data:{users:[]},error:e};throw e}}async getUserById(e){tQ(e);try{return await t4(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:re})}catch(e){if(tm(e))return{data:{user:null},error:e};throw e}}async updateUserById(e,t){tQ(e);try{return await t4(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:re})}catch(e){if(tm(e))return{data:{user:null},error:e};throw e}}async deleteUser(e,t=!1){tQ(e);try{return await t4(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:re})}catch(e){if(tm(e))return{data:{user:null},error:e};throw e}}async _listFactors(e){tQ(e.userId);try{let{data:t,error:r}=await t4(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:r}}catch(e){if(tm(e))return{data:null,error:e};throw e}}async _deleteFactor(e){tQ(e.userId),tQ(e.id);try{return{data:await t4(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(e){if(tm(e))return{data:null,error:e};throw e}}async _listOAuthClients(e){var t,r,s,i,a,n,o;try{let l={nextPage:null,lastPage:0,total:0},c=await t4(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(r=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==r?r:"",per_page:null!==(i=null===(s=null==e?void 0:e.perPage)||void 0===s?void 0:s.toString())&&void 0!==i?i:""},xform:rs});if(c.error)throw c.error;let u=await c.json(),h=null!==(a=c.headers.get("x-total-count"))&&void 0!==a?a:0,d=null!==(o=null===(n=c.headers.get("link"))||void 0===n?void 0:n.split(","))&&void 0!==o?o:[];return d.length>0&&(d.forEach(e=>{let t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(e.split(";")[1].split("=")[1]);l[`${r}Page`]=t}),l.total=parseInt(h)),{data:Object.assign(Object.assign({},u),l),error:null}}catch(e){if(tm(e))return{data:{clients:[]},error:e};throw e}}async _createOAuthClient(e){try{return await t4(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(tm(e))return{data:null,error:e};throw e}}async _getOAuthClient(e){try{return await t4(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(tm(e))return{data:null,error:e};throw e}}async _updateOAuthClient(e,t){try{return await t4(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:t,headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(tm(e))return{data:null,error:e};throw e}}async _deleteOAuthClient(e){try{return await t4(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(e){if(tm(e))return{data:null,error:e};throw e}}async _regenerateOAuthClientSecret(e){try{return await t4(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(tm(e))return{data:null,error:e};throw e}}}function rn(e={}){return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}let ro={debug:!!(globalThis&&tL()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"))};class rl extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class rc extends rl{}async function ru(e,t,r){ro.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);let s=new globalThis.AbortController;return t>0&&setTimeout(()=>{s.abort(),ro.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async s=>{if(s){ro.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,s.name);try{return await r()}finally{ro.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,s.name)}}else{if(0===t)throw ro.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new rc(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(ro.debug)try{let e=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(e){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",e)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}function rh(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}class rd extends Error{constructor({message:e,code:t,cause:r,name:s}){var i;super(e,{cause:r}),this.__isWebAuthnError=!0,this.name=null!==(i=null!=s?s:r instanceof Error?r.name:void 0)&&void 0!==i?i:"Unknown Error",this.code=t}}class rp extends rd{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}class rf{createNewAbortSignal(){if(this.controller){let e=Error("Cancelling existing WebAuthn API call for new one");e.name="AbortError",this.controller.abort(e)}let e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){let e=Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}let rm=new rf;function rg(e){return"localhost"===e||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function ry(){var e,t;return!!(tU()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&"function"==typeof(null===(e=null==navigator?void 0:navigator.credentials)||void 0===e?void 0:e.create)&&"function"==typeof(null===(t=null==navigator?void 0:navigator.credentials)||void 0===t?void 0:t.get))}async function rb(e){try{let t=await navigator.credentials.create(e);if(!t)return{data:null,error:new rp("Empty credential response",t)};if(!(t instanceof PublicKeyCredential))return{data:null,error:new rp("Browser returned unexpected credential type",t)};return{data:t,error:null}}catch(t){return{data:null,error:function({error:e,options:t}){var r,s,i;let{publicKey:a}=t;if(!a)throw Error("options was missing required publicKey property");if("AbortError"===e.name){if(t.signal instanceof AbortSignal)return new rd({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if("ConstraintError"===e.name){if((null===(r=a.authenticatorSelection)||void 0===r?void 0:r.requireResidentKey)===!0)return new rd({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if("conditional"===t.mediation&&(null===(s=a.authenticatorSelection)||void 0===s?void 0:s.userVerification)==="required")return new rd({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if((null===(i=a.authenticatorSelection)||void 0===i?void 0:i.userVerification)==="required")return new rd({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else if("InvalidStateError"===e.name)return new rd({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});else if("NotAllowedError"===e.name)return new rd({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});else if("NotSupportedError"===e.name)return new rd(0===a.pubKeyCredParams.filter(e=>"public-key"===e.type).length?{message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}:{message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});else if("SecurityError"===e.name){let t=window.location.hostname;if(!rg(t))return new rd({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e});if(a.rp.id!==t)return new rd({message:`The RP ID "${a.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else if("TypeError"===e.name){if(a.user.id.byteLength<1||a.user.id.byteLength>64)return new rd({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if("UnknownError"===e.name)return new rd({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e});return new rd({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}({error:t,options:e})}}}async function rv(e){try{let t=await navigator.credentials.get(e);if(!t)return{data:null,error:new rp("Empty credential response",t)};if(!(t instanceof PublicKeyCredential))return{data:null,error:new rp("Browser returned unexpected credential type",t)};return{data:t,error:null}}catch(t){return{data:null,error:function({error:e,options:t}){let{publicKey:r}=t;if(!r)throw Error("options was missing required publicKey property");if("AbortError"===e.name){if(t.signal instanceof AbortSignal)return new rd({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if("NotAllowedError"===e.name)return new rd({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});else if("SecurityError"===e.name){let t=window.location.hostname;if(!rg(t))return new rd({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e});if(r.rpId!==t)return new rd({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else if("UnknownError"===e.name)return new rd({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e});return new rd({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}({error:t,options:e})}}}let rw={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},r_={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function rx(...e){let t=e=>null!==e&&"object"==typeof e&&!Array.isArray(e),r=e=>e instanceof ArrayBuffer||ArrayBuffer.isView(e),s={};for(let i of e)if(i)for(let e in i){let a=i[e];if(void 0!==a){if(Array.isArray(a))s[e]=a;else if(r(a))s[e]=a;else if(t(a)){let r=s[e];t(r)?s[e]=rx(r,a):s[e]=rx(a)}else s[e]=a}}return s}class rk{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:r,signal:s},i){try{var a,n,o,l;let{data:c,error:u}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!c)return{data:null,error:u};let h=null!=s?s:rm.createNewAbortSignal();if("create"===c.webauthn.type){let{user:e}=c.webauthn.credential_options.publicKey;e.name||(e.name=`${e.id}:${r}`),e.displayName||(e.displayName=e.name)}switch(c.webauthn.type){case"create":{let t=(a=c.webauthn.credential_options.publicKey,n=null==i?void 0:i.create,rx(rw,a,n||{})),{data:r,error:s}=await rb({publicKey:t,signal:h});if(r)return{data:{factorId:e,challengeId:c.id,webauthn:{type:c.webauthn.type,credential_response:r}},error:null};return{data:null,error:s}}case"request":{let t=(o=c.webauthn.credential_options.publicKey,l=null==i?void 0:i.request,rx(r_,o,l||{})),{data:r,error:s}=await rv(Object.assign(Object.assign({},c.webauthn.credential_options),{publicKey:t,signal:h}));if(r)return{data:{factorId:e,challengeId:c.id,webauthn:{type:c.webauthn.type,credential_response:r}},error:null};return{data:null,error:s}}}}catch(e){if(tm(e))return{data:null,error:e};return{data:null,error:new ty("Unexpected error in challenge",e)}}}async _verify({challengeId:e,factorId:t,webauthn:r}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:r})}async _authenticate({factorId:e,webauthn:{rpId:t="undefined"!=typeof window?window.location.hostname:void 0,rpOrigins:r="undefined"!=typeof window?[window.location.origin]:void 0,signal:s}={}},i){if(!t)return{data:null,error:new tf("rpId is required for WebAuthn authentication")};try{if(!ry())return{data:null,error:new ty("Browser does not support WebAuthn",null)};let{data:a,error:n}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:r},signal:s},{request:i});if(!a)return{data:null,error:n};let{webauthn:o}=a;return this._verify({factorId:e,challengeId:a.challengeId,webauthn:{type:o.type,rpId:t,rpOrigins:r,credential_response:o.credential_response}})}catch(e){if(tm(e))return{data:null,error:e};return{data:null,error:new ty("Unexpected error in authenticate",e)}}}async _register({friendlyName:e,webauthn:{rpId:t="undefined"!=typeof window?window.location.hostname:void 0,rpOrigins:r="undefined"!=typeof window?[window.location.origin]:void 0,signal:s}={}},i){if(!t)return{data:null,error:new tf("rpId is required for WebAuthn registration")};try{if(!ry())return{data:null,error:new ty("Browser does not support WebAuthn",null)};let{data:a,error:n}=await this._enroll({friendlyName:e});if(!a)return await this.client.mfa.listFactors().then(t=>{var r;return null===(r=t.data)||void 0===r?void 0:r.all.find(t=>"webauthn"===t.factor_type&&t.friendly_name===e&&"unverified"!==t.status)}).then(e=>e?this.client.mfa.unenroll({factorId:null==e?void 0:e.id}):void 0),{data:null,error:n};let{data:o,error:l}=await this._challenge({factorId:a.id,friendlyName:a.friendly_name,webauthn:{rpId:t,rpOrigins:r},signal:s},{create:i});if(!o)return{data:null,error:l};return this._verify({factorId:a.id,challengeId:o.challengeId,webauthn:{rpId:t,rpOrigins:r,type:o.webauthn.type,credential_response:o.webauthn.credential_response}})}catch(e){if(tm(e))return{data:null,error:e};return{data:null,error:new ty("Unexpected error in register",e)}}}}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();let rj={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:tu,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function rS(e,t,r){return await r()}let rE={};class rT{get jwks(){var e,t;return null!==(t=null===(e=rE[this.storageKey])||void 0===e?void 0:e.jwks)&&void 0!==t?t:{keys:[]}}set jwks(e){rE[this.storageKey]=Object.assign(Object.assign({},rE[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return null!==(t=null===(e=rE[this.storageKey])||void 0===e?void 0:e.cachedAt)&&void 0!==t?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){rE[this.storageKey]=Object.assign(Object.assign({},rE[this.storageKey]),{cachedAt:e})}constructor(e){var t,r,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;let i=Object.assign(Object.assign({},rj),e);if(this.storageKey=i.storageKey,this.instanceID=null!==(t=rT.nextInstanceID[this.storageKey])&&void 0!==t?t:0,rT.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!i.debug,"function"==typeof i.debug&&(this.logger=i.debug),this.instanceID>0&&tU()){let e=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(e),this.logDebugMessages&&console.trace(e)}if(this.persistSession=i.persistSession,this.autoRefreshToken=i.autoRefreshToken,this.admin=new ra({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=tB(i.fetch),this.lock=i.lock||rS,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,this.throwOnError=i.throwOnError,i.lock?this.lock=i.lock:tU()&&(null===(r=null==globalThis?void 0:globalThis.navigator)||void 0===r?void 0:r.locks)?this.lock=ru:this.lock=rS,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new rk(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:tL()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=rn(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=rn(this.memoryStorage)),tU()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(e){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",e)}null===(s=this.broadcastChannel)||void 0===s||s.addEventListener("message",async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${tc}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){var e;try{let t={},r="none";if(tU()&&(t=function(e){let t={},r=new URL(e);if(r.hash&&"#"===r.hash[0])try{new URLSearchParams(r.hash.substring(1)).forEach((e,r)=>{t[r]=e})}catch(e){}return r.searchParams.forEach((e,r)=>{t[r]=e}),t}(window.location.href),this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce")),tU()&&this.detectSessionInUrl&&"none"!==r){let{data:s,error:i}=await this._getSessionFromURL(t,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),tm(i)&&"AuthImplicitGrantRedirectError"===i.name){let t=null===(e=i.details)||void 0===e?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:i}}return await this._removeSession(),{error:i}}let{session:a,redirectType:n}=s;return this._debug("#_initialize()","detected session in URL",a,"redirect type",n),await this._saveSession(a),setTimeout(async()=>{"recovery"===n?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){if(tm(e))return this._returnResult({error:e});return this._returnResult({error:new ty("Unexpected error during initialization",e)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,s;try{let{data:i,error:a}=await t4(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(r=null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==r?r:{},gotrue_meta_security:{captcha_token:null===(s=null==e?void 0:e.options)||void 0===s?void 0:s.captchaToken}},xform:t9});if(a||!i)return this._returnResult({data:{user:null,session:null},error:a});let n=i.session,o=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",n)),this._returnResult({data:{user:o,session:n},error:null})}catch(e){if(tm(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signUp(e){var t,r,s;try{let i;if("email"in e){let{email:r,password:s,options:a}=e,n=null,o=null;"pkce"===this.flowType&&([n,o]=await tZ(this.storage,this.storageKey)),i=await t4(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==a?void 0:a.emailRedirectTo,body:{email:r,password:s,data:null!==(t=null==a?void 0:a.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken},code_challenge:n,code_challenge_method:o},xform:t9})}else if("phone"in e){let{phone:t,password:a,options:n}=e;i=await t4(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:a,data:null!==(r=null==n?void 0:n.data)&&void 0!==r?r:{},channel:null!==(s=null==n?void 0:n.channel)&&void 0!==s?s:"sms",gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:t9})}else throw new t_("You must provide either an email or phone number and a password");let{data:a,error:n}=i;if(n||!a)return this._returnResult({data:{user:null,session:null},error:n});let o=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",o)),this._returnResult({data:{user:l,session:o},error:null})}catch(e){if(tm(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithPassword(e){try{let t;if("email"in e){let{email:r,password:s,options:i}=e;t=await t4(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:r,password:s,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:t7})}else if("phone"in e){let{phone:r,password:s,options:i}=e;t=await t4(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:r,password:s,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:t7})}else throw new t_("You must provide either an email or phone number and a password");let{data:r,error:s}=t;if(s)return this._returnResult({data:{user:null,session:null},error:s});if(!r||!r.session||!r.user){let e=new tw;return this._returnResult({data:{user:null,session:null},error:e})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s})}catch(e){if(tm(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithOAuth(e){var t,r,s,i;return await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(s=e.options)||void 0===s?void 0:s.queryParams,skipBrowserRedirect:null===(i=e.options)||void 0===i?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){let{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,r,s,i,a,n,o,l,c,u,h,d;let p,f;if("message"in e)p=e.message,f=e.signature;else{let u;let{chain:h,wallet:m,statement:g,options:y}=e;if(tU()){if("object"==typeof m)u=m;else{let e=window;if("ethereum"in e&&"object"==typeof e.ethereum&&"request"in e.ethereum&&"function"==typeof e.ethereum.request)u=e.ethereum;else throw Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}}else{if("object"!=typeof m||!(null==y?void 0:y.url))throw Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");u=m}let b=new URL(null!==(t=null==y?void 0:y.url)&&void 0!==t?t:window.location.href),v=await u.request({method:"eth_requestAccounts"}).then(e=>e).catch(()=>{throw Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!v||0===v.length)throw Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");let w=rh(v[0]),_=null===(r=null==y?void 0:y.signInWithEthereum)||void 0===r?void 0:r.chainId;_||(_=parseInt(await u.request({method:"eth_chainId"}),16)),p=function(e){var t;let{chainId:r,domain:s,expirationTime:i,issuedAt:a=new Date,nonce:n,notBefore:o,requestId:l,resources:c,scheme:u,uri:h,version:d}=e;if(!Number.isInteger(r))throw Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!s)throw Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(n&&n.length<8)throw Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${n}`);if(!h)throw Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if("1"!==d)throw Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${d}`);if(null===(t=e.statement)||void 0===t?void 0:t.includes("\n"))throw Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`);let p=rh(e.address),f=u?`${u}://${s}`:s,m=e.statement?`${e.statement}
`:"",g=`${f} wants you to sign in with your Ethereum account:
${p}

${m}`,y=`URI: ${h}
Version: ${d}
Chain ID: ${r}${n?`
Nonce: ${n}`:""}
Issued At: ${a.toISOString()}`;if(i&&(y+=`
Expiration Time: ${i.toISOString()}`),o&&(y+=`
Not Before: ${o.toISOString()}`),l&&(y+=`
Request ID: ${l}`),c){let e="\nResources:";for(let t of c){if(!t||"string"!=typeof t)throw Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${t}`);e+=`
- ${t}`}y+=e}return`${g}
${y}`}({domain:b.host,address:w,statement:g,uri:b.href,version:"1",chainId:_,nonce:null===(s=null==y?void 0:y.signInWithEthereum)||void 0===s?void 0:s.nonce,issuedAt:null!==(a=null===(i=null==y?void 0:y.signInWithEthereum)||void 0===i?void 0:i.issuedAt)&&void 0!==a?a:new Date,expirationTime:null===(n=null==y?void 0:y.signInWithEthereum)||void 0===n?void 0:n.expirationTime,notBefore:null===(o=null==y?void 0:y.signInWithEthereum)||void 0===o?void 0:o.notBefore,requestId:null===(l=null==y?void 0:y.signInWithEthereum)||void 0===l?void 0:l.requestId,resources:null===(c=null==y?void 0:y.signInWithEthereum)||void 0===c?void 0:c.resources}),f=await u.request({method:"personal_sign",params:[(d=p,"0x"+Array.from(new TextEncoder().encode(d),e=>e.toString(16).padStart(2,"0")).join("")),w]})}try{let{data:t,error:r}=await t4(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:p,signature:f},(null===(u=e.options)||void 0===u?void 0:u.captchaToken)?{gotrue_meta_security:{captcha_token:null===(h=e.options)||void 0===h?void 0:h.captchaToken}}:null),xform:t9});if(r)throw r;if(!t||!t.session||!t.user){let e=new tw;return this._returnResult({data:{user:null,session:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign({},t),error:r})}catch(e){if(tm(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithSolana(e){var t,r,s,i,a,n,o,l,c,u,h,d;let p,f;if("message"in e)p=e.message,f=e.signature;else{let h;let{chain:d,wallet:m,statement:g,options:y}=e;if(tU()){if("object"==typeof m)h=m;else{let e=window;if("solana"in e&&"object"==typeof e.solana&&("signIn"in e.solana&&"function"==typeof e.solana.signIn||"signMessage"in e.solana&&"function"==typeof e.solana.signMessage))h=e.solana;else throw Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}}else{if("object"!=typeof m||!(null==y?void 0:y.url))throw Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");h=m}let b=new URL(null!==(t=null==y?void 0:y.url)&&void 0!==t?t:window.location.href);if("signIn"in h&&h.signIn){let e;let t=await h.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},null==y?void 0:y.signInWithSolana),{version:"1",domain:b.host,uri:b.href}),g?{statement:g}:null));if(Array.isArray(t)&&t[0]&&"object"==typeof t[0])e=t[0];else if(t&&"object"==typeof t&&"signedMessage"in t&&"signature"in t)e=t;else throw Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in e&&"signature"in e&&("string"==typeof e.signedMessage||e.signedMessage instanceof Uint8Array)&&e.signature instanceof Uint8Array)p="string"==typeof e.signedMessage?e.signedMessage:new TextDecoder().decode(e.signedMessage),f=e.signature;else throw Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in h)||"function"!=typeof h.signMessage||!("publicKey"in h)||"object"!=typeof h||!h.publicKey||!("toBase58"in h.publicKey)||"function"!=typeof h.publicKey.toBase58)throw Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");p=[`${b.host} wants you to sign in with your Solana account:`,h.publicKey.toBase58(),...g?["",g,""]:[""],"Version: 1",`URI: ${b.href}`,`Issued At: ${null!==(s=null===(r=null==y?void 0:y.signInWithSolana)||void 0===r?void 0:r.issuedAt)&&void 0!==s?s:new Date().toISOString()}`,...(null===(i=null==y?void 0:y.signInWithSolana)||void 0===i?void 0:i.notBefore)?[`Not Before: ${y.signInWithSolana.notBefore}`]:[],...(null===(a=null==y?void 0:y.signInWithSolana)||void 0===a?void 0:a.expirationTime)?[`Expiration Time: ${y.signInWithSolana.expirationTime}`]:[],...(null===(n=null==y?void 0:y.signInWithSolana)||void 0===n?void 0:n.chainId)?[`Chain ID: ${y.signInWithSolana.chainId}`]:[],...(null===(o=null==y?void 0:y.signInWithSolana)||void 0===o?void 0:o.nonce)?[`Nonce: ${y.signInWithSolana.nonce}`]:[],...(null===(l=null==y?void 0:y.signInWithSolana)||void 0===l?void 0:l.requestId)?[`Request ID: ${y.signInWithSolana.requestId}`]:[],...(null===(u=null===(c=null==y?void 0:y.signInWithSolana)||void 0===c?void 0:c.resources)||void 0===u?void 0:u.length)?["Resources",...y.signInWithSolana.resources.map(e=>`- ${e}`)]:[]].join("\n");let e=await h.signMessage(new TextEncoder().encode(p),"utf8");if(!e||!(e instanceof Uint8Array))throw Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");f=e}}try{let{data:t,error:r}=await t4(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:p,signature:t$(f)},(null===(h=e.options)||void 0===h?void 0:h.captchaToken)?{gotrue_meta_security:{captcha_token:null===(d=e.options)||void 0===d?void 0:d.captchaToken}}:null),xform:t9});if(r)throw r;if(!t||!t.session||!t.user){let e=new tw;return this._returnResult({data:{user:null,session:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign({},t),error:r})}catch(e){if(tm(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async _exchangeCodeForSession(e){let t=await tF(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(null!=t?t:"").split("/");try{let{data:t,error:i}=await t4(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:t9});if(await tV(this.storage,`${this.storageKey}-code-verifier`),i)throw i;if(!t||!t.session||!t.user){let e=new tw;return this._returnResult({data:{user:null,session:null,redirectType:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign(Object.assign({},t),{redirectType:null!=s?s:null}),error:i})}catch(e){if(tm(e))return this._returnResult({data:{user:null,session:null,redirectType:null},error:e});throw e}}async signInWithIdToken(e){try{let{options:t,provider:r,token:s,access_token:i,nonce:a}=e,{data:n,error:o}=await t4(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:i,nonce:a,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:t9});if(o)return this._returnResult({data:{user:null,session:null},error:o});if(!n||!n.session||!n.user){let e=new tw;return this._returnResult({data:{user:null,session:null},error:e})}return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),this._returnResult({data:n,error:o})}catch(e){if(tm(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithOtp(e){var t,r,s,i,a;try{if("email"in e){let{email:s,options:i}=e,a=null,n=null;"pkce"===this.flowType&&([a,n]=await tZ(this.storage,this.storageKey));let{error:o}=await t4(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:s,data:null!==(t=null==i?void 0:i.data)&&void 0!==t?t:{},create_user:null===(r=null==i?void 0:i.shouldCreateUser)||void 0===r||r,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},code_challenge:a,code_challenge_method:n},redirectTo:null==i?void 0:i.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}if("phone"in e){let{phone:t,options:r}=e,{data:n,error:o}=await t4(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(s=null==r?void 0:r.data)&&void 0!==s?s:{},create_user:null===(i=null==r?void 0:r.shouldCreateUser)||void 0===i||i,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken},channel:null!==(a=null==r?void 0:r.channel)&&void 0!==a?a:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:null==n?void 0:n.message_id},error:o})}throw new t_("You must provide either an email or phone number.")}catch(e){if(tm(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async verifyOtp(e){var t,r;try{let s,i;"options"in e&&(s=null===(t=e.options)||void 0===t?void 0:t.redirectTo,i=null===(r=e.options)||void 0===r?void 0:r.captchaToken);let{data:a,error:n}=await t4(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:t9});if(n)throw n;if(!a)throw Error("An error occurred on token verification.");let o=a.session,l=a.user;return(null==o?void 0:o.access_token)&&(await this._saveSession(o),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",o)),this._returnResult({data:{user:l,session:o},error:null})}catch(e){if(tm(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithSSO(e){var t,r,s,i,a;try{let n=null,o=null;"pkce"===this.flowType&&([n,o]=await tZ(this.storage,this.storageKey));let l=await t4(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==r?r:void 0}),(null===(s=null==e?void 0:e.options)||void 0===s?void 0:s.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:o}),headers:this.headers,xform:rt});return(null===(i=l.data)||void 0===i?void 0:i.url)&&tU()&&!(null===(a=e.options)||void 0===a?void 0:a.skipBrowserRedirect)&&window.location.assign(l.data.url),this._returnResult(l)}catch(e){if(tm(e))return this._returnResult({data:null,error:e});throw e}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{let{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new tv;let{error:s}=await t4(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return this._returnResult({data:{user:null,session:null},error:s})})}catch(e){if(tm(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{let t=`${this.url}/resend`;if("email"in e){let{email:r,type:s,options:i}=e,{error:a}=await t4(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},redirectTo:null==i?void 0:i.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:a})}if("phone"in e){let{phone:r,type:s,options:i}=e,{data:a,error:n}=await t4(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:null==a?void 0:a.message_id},error:n})}throw new t_("You must provide either an email or phone number and a type")}catch(e){if(tm(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){let e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await r}catch(e){}})()),r}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;let e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(e){}})()),await e;this.pendingInLock.length;){let e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{let t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",Error().stack);try{let t=null,r=await tF(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),null!==r&&(this._isValidSession(r)?t=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};let s=!!t.expires_at&&1e3*t.expires_at-Date.now()<9e4;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",t.expires_at),!s){if(this.userStorage){let e=await tF(this.userStorage,this.storageKey+"-user");(null==e?void 0:e.user)?t.user=e.user:t.user=t0()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){var e;let r={value:this.suppressGetSessionWarning};t.user=(e=t.user,new Proxy(e,{get:(e,t,s)=>{if("__isInsecureUserWarningProxy"===t)return!0;if("symbol"==typeof t){let r=t.toString();if("Symbol(Symbol.toPrimitive)"===r||"Symbol(Symbol.toStringTag)"===r||"Symbol(util.inspect.custom)"===r||"Symbol(nodejs.util.inspect.custom)"===r)return Reflect.get(e,t,s)}return r.value||"string"!=typeof t||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),r.value=!0),Reflect.get(e,t,s)}})),r.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}let{data:i,error:a}=await this._callRefreshToken(t.refresh_token);if(a)return this._returnResult({data:{session:null},error:a});return this._returnResult({data:{session:i},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{if(e)return await t4(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:re});return await this._useSession(async e=>{var t,r,s;let{data:i,error:a}=e;if(a)throw a;return(null===(t=i.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await t4(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(s=null===(r=i.session)||void 0===r?void 0:r.access_token)&&void 0!==s?s:void 0,xform:re}):{data:{user:null},error:new tv}})}catch(e){if(tm(e))return tm(e)&&"AuthSessionMissingError"===e.name&&(await this._removeSession(),await tV(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:e});throw e}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{let{data:s,error:i}=r;if(i)throw i;if(!s.session)throw new tv;let a=s.session,n=null,o=null;"pkce"===this.flowType&&null!=e.email&&([n,o]=await tZ(this.storage,this.storageKey));let{data:l,error:c}=await t4(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:n,code_challenge_method:o}),jwt:a.access_token,xform:re});if(c)throw c;return a.user=l.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),this._returnResult({data:{user:a.user},error:null})})}catch(e){if(tm(e))return this._returnResult({data:{user:null},error:e});throw e}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new tv;let t=Date.now()/1e3,r=t,s=!0,i=null,{payload:a}=tK(e.access_token);if(a.exp&&(s=(r=a.exp)<=t),s){let{data:t,error:r}=await this._callRefreshToken(e.refresh_token);if(r)return this._returnResult({data:{user:null,session:null},error:r});if(!t)return{data:{user:null,session:null},error:null};i=t}else{let{data:s,error:a}=await this._getUser(e.access_token);if(a)throw a;i={access_token:e.access_token,refresh_token:e.refresh_token,user:s.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return this._returnResult({data:{user:i.user,session:i},error:null})}catch(e){if(tm(e))return this._returnResult({data:{session:null,user:null},error:e});throw e}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){let{data:s,error:i}=t;if(i)throw i;e=null!==(r=s.session)&&void 0!==r?r:void 0}if(!(null==e?void 0:e.refresh_token))throw new tv;let{data:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{user:null,session:null},error:i}):s?this._returnResult({data:{user:s.user,session:s},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(e){if(tm(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async _getSessionFromURL(e,t){try{if(!tU())throw new tx("No browser detected.");if(e.error||e.error_description||e.error_code)throw new tx(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new tk("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new tx("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new tk("No code detected.");let{data:t,error:r}=await this._exchangeCodeForSession(e.code);if(r)throw r;let s=new URL(window.location.href);return s.searchParams.delete("code"),window.history.replaceState(window.history.state,"",s.toString()),{data:{session:t.session,redirectType:null},error:null}}let{provider_token:r,provider_refresh_token:s,access_token:i,refresh_token:a,expires_in:n,expires_at:o,token_type:l}=e;if(!i||!n||!a||!l)throw new tx("No session defined in URL");let c=Math.round(Date.now()/1e3),u=parseInt(n),h=c+u;o&&(h=parseInt(o));let d=h-c;1e3*d<=3e4&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${d}s, should have been closer to ${u}s`);let p=h-u;c-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,h,c):c-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,h,c);let{data:f,error:m}=await this._getUser(i);if(m)throw m;let g={provider_token:r,provider_refresh_token:s,access_token:i,expires_in:u,expires_at:h,refresh_token:a,token_type:l,user:f.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:g,redirectType:e.type},error:null})}catch(e){if(tm(e))return this._returnResult({data:{session:null,redirectType:null},error:e});throw e}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){let t=await tF(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;let{data:s,error:i}=t;if(i)return this._returnResult({error:i});let a=null===(r=s.session)||void 0===r?void 0:r.access_token;if(a){let{error:t}=await this.admin.signOut(a,e);if(t&&!(tm(t)&&"AuthApiError"===t.name&&(404===t.status||401===t.status||403===t.status)))return this._returnResult({error:t})}return"others"!==e&&(await this._removeSession(),await tV(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){let t=Symbol("auth-callback"),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>{await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})})(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,s;try{let{data:{session:s},error:i}=t;if(i)throw i;await (null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(t){await (null===(s=this.stateChangeEmitters.get(e))||void 0===s?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",t),console.error(t)}})}async resetPasswordForEmail(e,t={}){let r=null,s=null;"pkce"===this.flowType&&([r,s]=await tZ(this.storage,this.storageKey,!0));try{return await t4(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(e){if(tm(e))return this._returnResult({data:null,error:e});throw e}}async getUserIdentities(){var e;try{let{data:t,error:r}=await this.getUser();if(r)throw r;return this._returnResult({data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null})}catch(e){if(tm(e))return this._returnResult({data:null,error:e});throw e}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{let{data:r,error:s}=await this._useSession(async t=>{var r,s,i,a,n;let{data:o,error:l}=t;if(l)throw l;let c=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null===(r=e.options)||void 0===r?void 0:r.redirectTo,scopes:null===(s=e.options)||void 0===s?void 0:s.scopes,queryParams:null===(i=e.options)||void 0===i?void 0:i.queryParams,skipBrowserRedirect:!0});return await t4(this.fetch,"GET",c,{headers:this.headers,jwt:null!==(n=null===(a=o.session)||void 0===a?void 0:a.access_token)&&void 0!==n?n:void 0})});if(s)throw s;return!tU()||(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)||window.location.assign(null==r?void 0:r.url),this._returnResult({data:{provider:e.provider,url:null==r?void 0:r.url},error:null})}catch(t){if(tm(t))return this._returnResult({data:{provider:e.provider,url:null},error:t});throw t}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var r;try{let{error:s,data:{session:i}}=t;if(s)throw s;let{options:a,provider:n,token:o,access_token:l,nonce:c}=e,{data:u,error:h}=await t4(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:null!==(r=null==i?void 0:i.access_token)&&void 0!==r?r:void 0,body:{provider:n,id_token:o,access_token:l,nonce:c,link_identity:!0,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},xform:t9});if(h)return this._returnResult({data:{user:null,session:null},error:h});if(!u||!u.session||!u.user)return this._returnResult({data:{user:null,session:null},error:new tw});return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("USER_UPDATED",u.session)),this._returnResult({data:u,error:h})}catch(e){if(tm(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,s;let{data:i,error:a}=t;if(a)throw a;return await t4(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!==(s=null===(r=i.session)||void 0===r?void 0:r.access_token)&&void 0!==s?s:void 0})})}catch(e){if(tm(e))return this._returnResult({data:null,error:e});throw e}}async _refreshAccessToken(e){let t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{var r,s;let i=Date.now();return await (r=async r=>(r>0&&await tH(200*Math.pow(2,r-1)),this._debug(t,"refreshing attempt",r),await t4(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:t9})),s=(e,t)=>t&&tS(t)&&Date.now()+200*Math.pow(2,e)-i<3e4,new Promise((e,t)=>{(async()=>{for(let i=0;i<1/0;i++)try{let t=await r(i);if(!s(i,null,t)){e(t);return}}catch(e){if(!s(i,e)){t(e);return}}})()}))}catch(e){if(this._debug(t,"error",e),tm(e))return this._returnResult({data:{session:null,user:null},error:e});throw e}finally{this._debug(t,"end")}}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){let r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),tU()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,t;let r="#_recoverAndRefresh()";this._debug(r,"begin");try{let s=await tF(this.storage,this.storageKey);if(s&&this.userStorage){let t=await tF(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!t&&(t={user:s.user},await tM(this.userStorage,this.storageKey+"-user",t)),s.user=null!==(e=null==t?void 0:t.user)&&void 0!==e?e:t0()}else if(s&&!s.user&&!s.user){let e=await tF(this.storage,this.storageKey+"-user");e&&(null==e?void 0:e.user)?(s.user=e.user,await tV(this.storage,this.storageKey+"-user"),await tM(this.storage,this.storageKey,s)):s.user=t0()}if(this._debug(r,"session from storage",s),!this._isValidSession(s)){this._debug(r,"session is not valid"),null!==s&&await this._removeSession();return}let i=(null!==(t=s.expires_at)&&void 0!==t?t:1/0)*1e3-Date.now()<9e4;if(this._debug(r,`session has${i?"":" not"} expired with margin of 90000s`),i){if(this.autoRefreshToken&&s.refresh_token){let{error:e}=await this._callRefreshToken(s.refresh_token);e&&(console.error(e),tS(e)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else if(s.user&&!0===s.user.__isUserNotAvailableProxy)try{let{data:e,error:t}=await this._getUser(s.access_token);!t&&(null==e?void 0:e.user)?(s.user=e.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(e){console.error("Error getting user data:",e),this._debug(r,"error getting user data, skipping SIGNED_IN notification",e)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(e){this._debug(r,"error",e),console.error(e);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new tv;if(this.refreshingDeferred)return this.refreshingDeferred.promise;let s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new tW;let{data:t,error:r}=await this._refreshAccessToken(e);if(r)throw r;if(!t.session)throw new tv;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);let s={data:t.session,error:null};return this.refreshingDeferred.resolve(s),s}catch(e){if(this._debug(s,"error",e),tm(e)){let r={data:null,error:e};return tS(e)||await this._removeSession(),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(r),r}throw null===(r=this.refreshingDeferred)||void 0===r||r.reject(e),e}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,r=!0){let s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});let s=[],i=Array.from(this.stateChangeEmitters.values()).map(async r=>{try{await r.callback(e,t)}catch(e){s.push(e)}});if(await Promise.all(i),s.length>0){for(let e=0;e<s.length;e+=1)console.error(s[e]);throw s[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;let t=Object.assign({},e),r=t.user&&!0===t.user.__isUserNotAvailableProxy;if(this.userStorage){!r&&t.user&&await tM(this.userStorage,this.storageKey+"-user",{user:t.user});let e=Object.assign({},t);delete e.user;let s=t1(e);await tM(this.storage,this.storageKey,s)}else{let e=t1(t);await tM(this.storage,this.storageKey,e)}}async _removeSession(){this._debug("#_removeSession()"),await tV(this.storage,this.storageKey),await tV(this.storage,this.storageKey+"-code-verifier"),await tV(this.storage,this.storageKey+"-user"),this.userStorage&&await tV(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");let e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&tU()&&(null==window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(e){console.error("removing visibilitychange callback failed",e)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");let e=setInterval(()=>this._autoRefreshTokenTick(),3e4);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");let e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{let e=Date.now();try{return await this._useSession(async t=>{let{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}let s=Math.floor((1e3*r.expires_at-e)/3e4);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),s<=3&&await this._callRefreshToken(r.refresh_token)})}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof rl)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!tU()||!(null==window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null==window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){let t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if("visible"!==document.visibilityState){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){let s=[`provider=${encodeURIComponent(t)}`];if((null==r?void 0:r.redirectTo)&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),(null==r?void 0:r.scopes)&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),"pkce"===this.flowType){let[e,t]=await tZ(this.storage,this.storageKey),r=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});s.push(r.toString())}if(null==r?void 0:r.queryParams){let e=new URLSearchParams(r.queryParams);s.push(e.toString())}return(null==r?void 0:r.skipBrowserRedirect)&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;let{data:s,error:i}=t;return i?this._returnResult({data:null,error:i}):await t4(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token})})}catch(e){if(tm(e))return this._returnResult({data:null,error:e});throw e}}async _enroll(e){try{return await this._useSession(async t=>{var r,s;let{data:i,error:a}=t;if(a)return this._returnResult({data:null,error:a});let n=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:"totp"===e.factorType?{issuer:e.issuer}:{}),{data:o,error:l}=await t4(this.fetch,"POST",`${this.url}/factors`,{body:n,headers:this.headers,jwt:null===(r=null==i?void 0:i.session)||void 0===r?void 0:r.access_token});return l?this._returnResult({data:null,error:l}):("totp"===e.factorType&&"totp"===o.type&&(null===(s=null==o?void 0:o.totp)||void 0===s?void 0:s.qr_code)&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),this._returnResult({data:o,error:null}))})}catch(e){if(tm(e))return this._returnResult({data:null,error:e});throw e}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r,s,i;let{data:a,error:n}=t;if(n)return this._returnResult({data:null,error:n});let o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:"create"===e.webauthn.type?(s=e.webauthn.credential_response,"toJSON"in s&&"function"==typeof s.toJSON?s.toJSON():{id:s.id,rawId:s.id,response:{attestationObject:t$(new Uint8Array(s.response.attestationObject)),clientDataJSON:t$(new Uint8Array(s.response.clientDataJSON))},type:"public-key",clientExtensionResults:s.getClientExtensionResults(),authenticatorAttachment:null!==(i=s.authenticatorAttachment)&&void 0!==i?i:void 0}):function(e){var t;if("toJSON"in e&&"function"==typeof e.toJSON)return e.toJSON();let r=e.getClientExtensionResults(),s=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:t$(new Uint8Array(s.authenticatorData)),clientDataJSON:t$(new Uint8Array(s.clientDataJSON)),signature:t$(new Uint8Array(s.signature)),userHandle:s.userHandle?t$(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:null!==(t=e.authenticatorAttachment)&&void 0!==t?t:void 0}}(e.webauthn.credential_response)})}:{code:e.code}),{data:l,error:c}=await t4(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:null===(r=null==a?void 0:a.session)||void 0===r?void 0:r.access_token});return c?this._returnResult({data:null,error:c}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+l.expires_in},l)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",l),this._returnResult({data:l,error:c}))})}catch(e){if(tm(e))return this._returnResult({data:null,error:e});throw e}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;let{data:s,error:i}=t;if(i)return this._returnResult({data:null,error:i});let a=await t4(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token});if(a.error)return a;let{data:n}=a;if("webauthn"!==n.type)return{data:n,error:null};switch(n.webauthn.type){case"create":return{data:Object.assign(Object.assign({},n),{webauthn:Object.assign(Object.assign({},n.webauthn),{credential_options:Object.assign(Object.assign({},n.webauthn.credential_options),{publicKey:function(e){if(!e)throw Error("Credential creation options are required");if("undefined"!=typeof PublicKeyCredential&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseCreationOptionsFromJSON)return PublicKeyCredential.parseCreationOptionsFromJSON(e);let{challenge:t,user:r,excludeCredentials:s}=e,i=(0,B.__rest)(e,["challenge","user","excludeCredentials"]),a=tP(t).buffer,n=Object.assign(Object.assign({},r),{id:tP(r.id).buffer}),o=Object.assign(Object.assign({},i),{challenge:a,user:n});if(s&&s.length>0){o.excludeCredentials=Array(s.length);for(let e=0;e<s.length;e++){let t=s[e];o.excludeCredentials[e]=Object.assign(Object.assign({},t),{id:tP(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return o}(n.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},n),{webauthn:Object.assign(Object.assign({},n.webauthn),{credential_options:Object.assign(Object.assign({},n.webauthn.credential_options),{publicKey:function(e){if(!e)throw Error("Credential request options are required");if("undefined"!=typeof PublicKeyCredential&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseRequestOptionsFromJSON)return PublicKeyCredential.parseRequestOptionsFromJSON(e);let{challenge:t,allowCredentials:r}=e,s=(0,B.__rest)(e,["challenge","allowCredentials"]),i=tP(t).buffer,a=Object.assign(Object.assign({},s),{challenge:i});if(r&&r.length>0){a.allowCredentials=Array(r.length);for(let e=0;e<r.length;e++){let t=r[e];a.allowCredentials[e]=Object.assign(Object.assign({},t),{id:tP(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return a}(n.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(e){if(tm(e))return this._returnResult({data:null,error:e});throw e}})}async _challengeAndVerify(e){let{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?this._returnResult({data:null,error:r}):await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;let{data:{user:t},error:r}=await this.getUser();if(r)return{data:null,error:r};let s={all:[],phone:[],totp:[],webauthn:[]};for(let r of null!==(e=null==t?void 0:t.factors)&&void 0!==e?e:[])s.all.push(r),"verified"===r.status&&s[r.factor_type].push(r);return{data:s,error:null}}async _getAuthenticatorAssuranceLevel(){var e,t;let{data:{session:r},error:s}=await this.getSession();if(s)return this._returnResult({data:null,error:s});if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};let{payload:i}=tK(r.access_token),a=null;i.aal&&(a=i.aal);let n=a;return(null!==(t=null===(e=r.user.factors)||void 0===e?void 0:e.filter(e=>"verified"===e.status))&&void 0!==t?t:[]).length>0&&(n="aal2"),{data:{currentLevel:a,nextLevel:n,currentAuthenticationMethods:i.amr||[]},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{let{data:{session:r},error:s}=t;return s?this._returnResult({data:null,error:s}):r?await t4(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:r.access_token,xform:e=>({data:e,error:null})}):this._returnResult({data:null,error:new tv})})}catch(e){if(tm(e))return this._returnResult({data:null,error:e});throw e}}async _approveAuthorization(e,t){try{return await this._useSession(async r=>{let{data:{session:s},error:i}=r;if(i)return this._returnResult({data:null,error:i});if(!s)return this._returnResult({data:null,error:new tv});let a=await t4(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"approve"},xform:e=>({data:e,error:null})});return a.data&&a.data.redirect_url&&tU()&&!(null==t?void 0:t.skipBrowserRedirect)&&window.location.assign(a.data.redirect_url),a})}catch(e){if(tm(e))return this._returnResult({data:null,error:e});throw e}}async _denyAuthorization(e,t){try{return await this._useSession(async r=>{let{data:{session:s},error:i}=r;if(i)return this._returnResult({data:null,error:i});if(!s)return this._returnResult({data:null,error:new tv});let a=await t4(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"deny"},xform:e=>({data:e,error:null})});return a.data&&a.data.redirect_url&&tU()&&!(null==t?void 0:t.skipBrowserRedirect)&&window.location.assign(a.data.redirect_url),a})}catch(e){if(tm(e))return this._returnResult({data:null,error:e});throw e}}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(t=>t.kid===e);if(r)return r;let s=Date.now();if((r=this.jwks.keys.find(t=>t.kid===e))&&this.jwks_cached_at+6e5>s)return r;let{data:i,error:a}=await t4(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(a)throw a;return i.keys&&0!==i.keys.length&&(this.jwks=i,this.jwks_cached_at=s,r=i.keys.find(t=>t.kid===e))?r:null}async getClaims(e,t={}){try{let r=e;if(!r){let{data:e,error:t}=await this.getSession();if(t||!e.session)return this._returnResult({data:null,error:t});r=e.session.access_token}let{header:s,payload:i,signature:a,raw:{header:n,payload:o}}=tK(r);(null==t?void 0:t.allowExpired)||function(e){if(!e)throw Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw Error("JWT has expired")}(i.exp);let l=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,(null==t?void 0:t.keys)?{keys:t.keys}:null==t?void 0:t.jwks);if(!l){let{error:e}=await this.getUser(r);if(e)throw e;return{data:{claims:i,header:s,signature:a},error:null}}let c=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw Error("Invalid alg claim")}}(s.alg),u=await crypto.subtle.importKey("jwk",l,c,!0,["verify"]);if(!await crypto.subtle.verify(c,u,a,function(e){let t=[];return function(e,t){for(let r=0;r<e.length;r+=1){let s=e.charCodeAt(r);if(s>55295&&s<=56319){let t=(s-55296)*1024&65535;s=(e.charCodeAt(r+1)-56320&65535|t)+65536,r+=1}!function(e,t){if(e<=127){t(e);return}if(e<=2047){t(192|e>>6),t(128|63&e);return}if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|63&e);return}if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|63&e);return}throw Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}(s,t)}}(e,e=>t.push(e)),new Uint8Array(t)}(`${n}.${o}`)))throw new tT("Invalid JWT signature");return{data:{claims:i,header:s,signature:a},error:null}}catch(e){if(tm(e))return this._returnResult({data:null,error:e});throw e}}}rT.nextInstanceID={};let rO=rT;class rN extends rO{constructor(e){super(e)}}class rC{constructor(e,t,r){var s,i,a;this.supabaseUrl=e,this.supabaseKey=t;let n=function(e){let t=null==e?void 0:e.trim();if(!t)throw Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(t.endsWith("/")?t:t+"/")}catch(e){throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}(e);if(!t)throw Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",n),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",n),this.storageUrl=new URL("storage/v1",n),this.functionsUrl=new URL("functions/v1",n);let o=`sb-${n.hostname.split(".")[0]}-auth-token`,l=function(e,t){var r,s;let{db:i,auth:a,realtime:n,global:o}=e,{db:l,auth:c,realtime:u,global:h}=t,d={db:Object.assign(Object.assign({},l),i),auth:Object.assign(Object.assign({},c),a),realtime:Object.assign(Object.assign({},u),n),storage:{},global:Object.assign(Object.assign(Object.assign({},h),o),{headers:Object.assign(Object.assign({},null!==(r=null==h?void 0:h.headers)&&void 0!==r?r:{}),null!==(s=null==o?void 0:o.headers)&&void 0!==s?s:{})}),accessToken:async()=>""};return e.accessToken?d.accessToken=e.accessToken:delete d.accessToken,d}(null!=r?r:{},{db:ts,realtime:ta,auth:Object.assign(Object.assign({},ti),{storageKey:o}),global:tr});this.storageKey=null!==(s=l.auth.storageKey)&&void 0!==s?s:"",this.headers=null!==(i=l.global.headers)&&void 0!==i?i:{},l.accessToken?(this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(a=l.auth)&&void 0!==a?a:{},this.headers,l.global.fetch),this.fetch=tl(t,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.accessToken&&this.accessToken().then(e=>this.realtime.setAuth(e)).catch(e=>console.warn("Failed to set initial Realtime auth token:",e)),this.rest=new J(new URL("rest/v1",n).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),this.storage=new te(this.storageUrl.href,this.headers,this.fetch,null==r?void 0:r.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new K(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,t;if(this.accessToken)return await this.accessToken();let{data:r}=await this.auth.getSession();return null!==(t=null===(e=r.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,userStorage:i,storageKey:a,flowType:n,lock:o,debug:l,throwOnError:c},u,h){let d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new rN({url:this.authUrl.href,headers:Object.assign(Object.assign({},d),u),storageKey:a,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,userStorage:i,flowType:n,lock:o,debug:l,throwOnError:c,fetch:h,hasCustomAuthorizationHeader:Object.keys(this.headers).some(e=>"authorization"===e.toLowerCase())})}_initRealtimeClient(e){return new e_(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(e,t,r){("TOKEN_REFRESHED"===e||"SIGNED_IN"===e)&&this.changedAccessToken!==r?(this.changedAccessToken=r,this.realtime.setAuth(r)):"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0)}}(function(){if("undefined"!=typeof window||"undefined"==typeof process)return!1;let e=process.version;if(null==e)return!1;let t=e.match(/^v(\d+)\./);return!!t&&18>=parseInt(t[1],10)})()&&console.warn(`  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217`);let rA="https://ijvpawrmzyfcvwnsyrqe.supabase.co",rR="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlqdnBhd3JtenlmY3Z3bnN5cnFlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIyMzc4ODEsImV4cCI6MjA3NzgxMzg4MX0.O3vmepENbBi4M3G3wfNwHK-gn50GgKUKhJCfwgUB-No",rI=rA&&rR?new rC(rA,rR,{auth:{persistSession:!0,detectSessionInUrl:!0}}):null;rI||console.warn("Supabase credentials are missing. Set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY in your .env.local file to enable Supabase features.");let rP="claim_receipts",r$=async(e,t)=>{if(!rP)return console.warn("Receipt upload skipped: NEXT_PUBLIC_SUPABASE_STORAGE_BUCKET is not set."),null;let r=e.name.split(".").pop()||"pdf",s=e.name.replace(/\.[^/.]+$/,"").toLowerCase().replace(/\s+/g,"-"),i=`receipts/${crypto.randomUUID?.()||Date.now()}-${s}.${r}`,{data:a,error:n}=await t.storage.from(rP).upload(i,e,{cacheControl:"3600",upsert:!1});if(n)throw Error(n.message);return a?.path??null},rU=async e=>{if(!rI)return{success:!1,error:"Supabase is not configured. Please update NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY in your .env.local file."};try{let t=[],r=[];for(let s of e.claimEntries){if(s.attachment){let e=await r$(s.attachment,rI);t.push(e)}else t.push(null);if(s.supportingAttachment){let e=await r$(s.supportingAttachment,rI);r.push(e)}else r.push(null)}let s=e.claimEntries.map((e,s)=>({description:e.description,currency:e.currency,amount:e.amount,service_date:e.serviceDate||null,claimant_name:e.claimantName||null,merchant_name:e.merchantName||null,is_optical_receipt:e.isOpticalReceipt??null,benefit_type:e.benefitType||null,optical_verification:e.opticalVerification||null,receipt_path:t[s],supporting_receipt_path:r[s]})),i={personalInformation:e.personalInformation,workDetails:e.workDetails,clinicName:e.clinicName||null,headcount:e.headcount||null,receiptCount:e.receiptCount,localCurrency:e.localCurrency,claimEntries:s,primaryReceiptPaths:t,supportingReceiptPaths:r},{error:a}=await rI.from("claims").insert({user_email:e.userEmail,category:e.staffClaimType,amount:e.totalAmount,date:new Date().toISOString(),description:JSON.stringify(i),provider:e.workDetails.department,receipt_path:JSON.stringify(t),status:"pending"});if(a)return{success:!1,error:a.message};return{success:!0}}catch(e){if(e instanceof Error)return{success:!1,error:e.message};return{success:!1,error:"Unexpected error while submitting claim."}}};r(4827);var rD=r(567),rL=r(7863),rB=r(4996),rq=r(5534);let rM=(e,t)=>{let r=t.trim();if(!r)return e;let s=e.trim();return s?s.toLowerCase().includes(r.toLowerCase())?s:`${s} - ${r}`:r},rF=e=>{if(!e)return"";let t=e.trim();if(!t)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(t))return t;let r=new Date(t);if(!Number.isNaN(r.getTime()))return r.toISOString().slice(0,10);let s=t.match(/^(\d{1,2})[\/\-\.](\d{1,2})[\/\-\.](\d{2,4})$/);if(s){let[,e,t,r]=s,i=2===r.length?`20${r}`:r,a=parseInt(e,10),n=parseInt(t,10);return n>12&&a<=12?`${i}-${String(a).padStart(2,"0")}-${String(n).padStart(2,"0")}`:`${i}-${String(n).padStart(2,"0")}-${String(a).padStart(2,"0")}`}return""},rV=e=>e&&e.type.startsWith("image/")?URL.createObjectURL(e):null,rW=e=>{if(!e)return"";let t=e.trim().toLowerCase();return t?t.includes("optic")||t.includes("vision")||t.includes("lens")?"Optical":t.includes("dental")||t.includes("dentist")||t.includes("orthodont")?"Dental":t.includes("health screening")||t.includes("medical check")||t.includes("screening")||t.includes("wellness")?"Health Screening":"":""},rK=["All","Belarus","British Virgin Islands","Cayman Islands","Cook Islands","Cyprus (Limassol)","Cyprus (Nicosia)","dsl","Dubai (Al Hamra Industrial Zone)","Dubai (Business Bay)","Dubai (Business Centre 2)","Dubai (JLT)","France","Germany","Guernsey","Hong Kong","Iran","Jordan","Malaysia (Cyberjaya)","Malaysia (Ipoh)","Malaysia (Labuan)","Malaysia (Melaka)","Malta","Mauritius","Not Applicable","Paraguay (Asuncion)","Paraguay (Ciudad del Este - CDE)","Rwanda","Senegal","Singapore","SVG - Saint Vincent And The Grenadines","Telecommuter","UK (London)","UK (Reading)","Vanuatu","Cyprus (dont use)","Panama","djl"],rH=["Accounting & Finance","Business Intelligence","Customer Support","Engineering","Facilities","Legal & Compliance","Marketing","People & Culture","Product","Risk & Compliance","Sales & Partnerships","Trading Operations","Other"],rG=["Deriv Services Sdn Bhd","Deriv (BVI) Ltd","Deriv (Cayman) Ltd","Deriv (France) SAS","Deriv (Guernsey) Ltd","Deriv (Malta) Ltd","Deriv (Mauritius) Ltd","Deriv (SVG) LLC","Regent Markets Group","Regent Markets Holdings","Other"],rJ=[{value:"Employee Benefit",label:"Employee Benefit",description:"Dental, optical, health screening reimbursements",icon:E},{value:"Travel Reimbursement",label:"Travel Reimbursement",description:"Travel, parking, taxi, mileage expenses",icon:T},{value:"Other Reimbursement",label:"Other Reimbursement",description:"Team building, meals, other approved costs",icon:O},{value:"Educational Assistance/Training",label:"Educational Assistance",description:"Courses, certifications, training fees",icon:N}],rz=["-","1","2","3","4","5","6","7","8","9","10"],rZ=["MYR","USD","EUR","GBP","SGD","AED","AUD","JPY","IDR","Other"],rY=["Optical","Dental","Health Screening"],rX=e=>{e&&URL.revokeObjectURL(e)},rQ=e=>{e.forEach(e=>{rX(e.attachmentPreviewUrl),rX(e.supportingAttachmentPreviewUrl)})},r0=!!(s="true".toString())&&["1","true","yes","on"].includes(s.toLowerCase());function r1(){let e=(0,v.useRouter)(),{state:t,user:r}=(0,rB.k)({redirectIfUnauthorized:()=>e.push("/no-access")}),s=r?.email??"",[i,a]=(0,b.useState)(!1),[n,o]=(0,b.useState)(!1),[l,c]=(0,b.useState)(""),[u,h]=(0,b.useState)(!1),[d,p]=(0,b.useState)(""),[f,m]=(0,b.useState)(!1),[g,S]=(0,b.useState)([]),[E,T]=(0,b.useState)({});(0,b.useRef)([]);let[O,N]=(0,b.useState)({fullName:"",employeeId:"",department:"",regentEmail:"",location:"",hiringCompany:"",bankAccountNumber:"",bankName:"",staffClaimType:"",receiptCount:"",clinicName:"",headcount:"",localCurrency:""}),[B,q]=(0,b.useState)(null),[M,F]=(0,b.useState)(null),[V,W]=(0,b.useState)(!1),K=e=>{if(null==e)return null;let t="number"==typeof e?e:parseFloat(e);return Number.isNaN(t)||!Number.isFinite(t)?null:t.toFixed(2)},H=(e,t)=>{let r=t?.trim()||"USD";try{return new Intl.NumberFormat(void 0,{style:"currency",currency:r,maximumFractionDigits:2}).format(e)}catch{return`${r} ${e.toFixed(2)}`}},G=(0,b.useCallback)((e,t)=>{r0&&T(r=>({...r,[e]:t}))},[]),J=(0,b.useCallback)(async(e,t,r={})=>{if(r0){G(e,{state:"processing",message:"Scanning receipt..."});try{let s=new FormData;s.append("file",t),r.staffClaimType&&s.append("claimType",r.staffClaimType),r.localCurrency&&s.append("currencyHint",r.localCurrency),r.location&&s.append("localeHint",r.location),r.benefitType&&s.append("benefitTypeHint",r.benefitType);let i=await fetch("/api/receipt-ocr",{method:"POST",headers:(0,rq.g0)(),body:s}),a=await i.json().catch(()=>null);if(!i.ok)throw Error(a?.error||"Receipt scan failed.");if(!a?.data)throw Error("Receipt OCR returned no data.");let n=a.data,o=K(n.amount);S(t=>{let s=[...t],i=s[e];if(!i)return s;let a={...i};if(n.description&&(a.description=n.description.trim()),o&&(a.amount=o),n.currency?a.currency=n.currency:!a.currency&&r.localCurrency&&(a.currency=r.localCurrency),n.serviceDate){let e=rF(n.serviceDate);e&&(a.serviceDate=e)}if(n.customerName&&(a.claimantName=n.customerName),n.merchantName&&(a.merchantName=n.merchantName.trim(),a.description=rM(a.description,n.merchantName)),"boolean"==typeof n.isOpticalReceipt&&(a.isOpticalReceipt=n.isOpticalReceipt),"boolean"==typeof n.hasPrescriptionDetails||"string"==typeof n.opticalVerificationNote?a.opticalVerification={verified:!!(n.hasPrescriptionDetails||n.opticalVerificationNote),hasPrescriptionDetails:!!n.hasPrescriptionDetails,note:n.opticalVerificationNote||void 0}:a.isOpticalReceipt?a.opticalVerification=a.opticalVerification||{verified:!1,note:void 0}:a.opticalVerification=void 0,"Employee Benefit"===r.staffClaimType){let e=rW(n.benefitType)||(n.isOpticalReceipt?"Optical":"");e&&(a.benefitType=e)}else a.benefitType="";return s[e]=a,s}),N(e=>{let t={};return(!e.localCurrency&&n.currency&&(t.localCurrency=n.currency),n.merchantName&&"Employee Benefit"===e.staffClaimType&&!e.clinicName&&(t.clinicName=n.merchantName),0===Object.keys(t).length)?e:{...e,...t}}),G(e,{state:"success",message:"Receipt scan completed."})}catch(t){console.error("Receipt OCR failed",t),G(e,{state:"error",message:t instanceof Error?t.message:"Receipt scan failed."})}}},[G]),z=(0,b.useMemo)(()=>{let e=parseInt(O.receiptCount,10);return Number.isNaN(e)?0:Math.min(e,10)},[O.receiptCount]),Z=(0,b.useMemo)(()=>g.reduce((e,t)=>{let r=parseFloat(t.amount);return Number.isNaN(r)?e:e+r},0),[g]),Y=f&&!d,X=Y?"bg-muted/60 text-muted-foreground cursor-not-allowed":"",Q=(0,b.useMemo)(()=>[{label:"Full Name",value:O.fullName||"Not available"},{label:"Employee ID",value:O.employeeId||"Not available"},{label:"Department",value:O.department||"Not available"},{label:"Regent Email",value:O.regentEmail||"Not available"},{label:"Location",value:O.location||"Not available"},{label:"Hiring Company",value:O.hiringCompany||"Not available"}],[O.fullName,O.employeeId,O.department,O.regentEmail,O.location,O.hiringCompany]),ee=(0,b.useCallback)(()=>{S(e=>(e.length>0&&rQ(e),[])),T({})},[]),et=e=>{let{name:t,value:r}=e.target;N(e=>({...e,[t]:r}))},er=(0,b.useCallback)(e=>{if(!e){N(e=>({...e,staffClaimType:"",receiptCount:""})),ee();return}let t=!1;N(r=>r.staffClaimType===e?r:(t=!0,{...r,staffClaimType:e,receiptCount:""})),t&&ee()},[ee]),es=(e,t,r)=>{S(s=>{let i=[...s],a=i[e];if(!a)return s;let n={...a,[t]:r};return"merchantName"===t&&r&&(n.description=rM(n.description,r)),"serviceDate"===t&&(n.serviceDate=rF(r)||r),"benefitType"===t&&(n.benefitType=rW(r)),i[e]=n,i})},ei=(e,t)=>{let r=g[e];if(S(r=>{let s=[...r],i=s[e];if(!i)return r;i.attachmentPreviewUrl&&rX(i.attachmentPreviewUrl);let a=rV(t);return s[e]={...i,attachment:t,attachmentPreviewUrl:a},s}),r0){if(!t){G(e,{state:"idle"});return}J(e,t,{staffClaimType:O.staffClaimType,localCurrency:O.localCurrency,location:O.location,benefitType:"Employee Benefit"===O.staffClaimType&&r?.benefitType||void 0})}},ea=(e,t)=>{S(r=>{let s=[...r],i=s[e];if(!i)return r;i.supportingAttachmentPreviewUrl&&rX(i.supportingAttachmentPreviewUrl);let a=rV(t);return s[e]={...i,supportingAttachment:t,supportingAttachmentPreviewUrl:a},s})},en=(e,t,r)=>{e.preventDefault(),e.stopPropagation();let s=e.dataTransfer?.files?.[0];s&&("primary"===r?ei(t,s):ea(t,s))},eo=(0,b.useMemo)(()=>O.department&&!rH.includes(O.department)?[...rH,O.department]:rH,[O.department]),el=(0,b.useMemo)(()=>O.location&&!rK.includes(O.location)?[...rK,O.location]:rK,[O.location]),ec=O.regentEmail.endsWith("@regentmarkets.com"),eu=(0,b.useMemo)(()=>!(["fullName","employeeId","department","regentEmail","location","hiringCompany","staffClaimType","receiptCount","localCurrency"].some(e=>!O[e])||!ec||O.hiringCompany&&(!O.bankAccountNumber||!O.bankName)||0===z||z!==g.length||g.some(e=>{if(!e.description||!e.currency||!e.amount||!e.serviceDate||!e.claimantName||!e.merchantName||"Employee Benefit"===O.staffClaimType&&!e.benefitType)return!0;let t=parseFloat(e.amount);return!!Number.isNaN(t)||t<=0||null===e.attachment}))&&!(Z<=0),[O,g,z,Z,ec]),eh=async e=>{e.preventDefault(),a(!0),c("");try{if(!s)throw Error("Unable to determine user. Please sign in again.");if(!eu)throw Error("Please complete all required fields before submitting.");let e=await rU({userEmail:s,staffClaimType:O.staffClaimType,totalAmount:Number(Z.toFixed(2)),localCurrency:O.localCurrency,receiptCount:z,personalInformation:{fullName:O.fullName,employeeId:O.employeeId,regentEmail:O.regentEmail},workDetails:{department:O.department,location:O.location,hiringCompany:O.hiringCompany,bankAccountNumber:O.bankAccountNumber||void 0,bankName:O.bankName||void 0},clinicName:O.clinicName||void 0,headcount:O.headcount||void 0,claimEntries:g.map(e=>({description:e.description,currency:e.currency,amount:parseFloat(e.amount),attachment:e.attachment,supportingAttachment:e.supportingAttachment,serviceDate:e.serviceDate,claimantName:e.claimantName,merchantName:e.merchantName,isOpticalReceipt:e.isOpticalReceipt,benefitType:e.benefitType||void 0,opticalVerification:e.opticalVerification}))});if(!e.success)throw Error(e.error||"Failed to submit claim.");o(!0),N({fullName:"",employeeId:"",department:"",regentEmail:s,location:"",hiringCompany:"",bankAccountNumber:"",bankName:"",staffClaimType:"",receiptCount:"",clinicName:"",headcount:"",localCurrency:""}),S(e=>(e.length>0&&rQ(e),[])),T({}),setTimeout(()=>{o(!1)},4e3)}catch(e){c(e instanceof Error?e.message:"Failed to submit claim. Please try again.")}finally{a(!1)}};if("loading"===t.status)return y.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-50 via-white to-coral-50 dark:from-slate-1100 dark:via-slate-1000 dark:to-slate-900",children:(0,y.jsxs)("div",{className:"text-center space-y-4",children:[y.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 rounded-2xl bg-gradient-coral shadow-lg",children:y.jsx("div",{className:"w-10 h-10 border-4 border-white/70 border-t-transparent rounded-full animate-spin"})}),(0,y.jsxs)("div",{children:[y.jsx("p",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:"Loading ClaimEase"}),y.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Please wait a moment"})]})]})});if("unauthorized"===t.status)return null;let ed=B??{total:0,used:0,remaining:0,currency:"USD"},ep=!!B,ef=ep&&Z>ed.remaining,em=ep?Math.max(Z-ed.remaining,0):0,eg=ep?Math.max(ed.remaining-Z,0):0,ey=ep&&!ef&&Z>0;return(0,y.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-coral-50 dark:from-slate-1100 dark:via-slate-1000 dark:to-slate-900 lg:pl-72",children:[y.jsx(w.W,{}),(0,y.jsxs)("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[(0,y.jsxs)("div",{className:"mb-8",children:[y.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Submit Claim"}),y.jsx("p",{className:"text-muted-foreground",children:"Complete every section below to match the official staff claim form requirements"})]}),(0,y.jsxs)(_.Zb,{className:"mb-8",children:[(0,y.jsxs)(_.Ol,{children:[y.jsx(_.ll,{children:"Submission Guide"}),y.jsx(_.SZ,{children:"Key reminders from the official Staff Claim Form Guide"})]}),(0,y.jsxs)(_.aY,{className:"text-sm text-muted-foreground space-y-4",children:[(0,y.jsxs)("div",{children:[y.jsx("p",{className:"font-medium text-foreground",children:"Prepare these documents before you start:"}),(0,y.jsxs)("ul",{className:"list-disc pl-5 space-y-1 mt-2",children:[y.jsx("li",{children:"Clear image of every receipt/invoice with your name on it"}),y.jsx("li",{children:"Approval conversation from an authorised approver (mandatory)"}),y.jsx("li",{children:"Supporting documents tied to the claim type (certificates, approvals, etc.)"}),y.jsx("li",{children:"Approved team-building proposal form for team building/lunch claims"})]})]}),(0,y.jsxs)("div",{children:[y.jsx("p",{className:"font-medium text-foreground",children:"Submission rules:"}),(0,y.jsxs)("ul",{className:"list-disc pl-5 space-y-1 mt-2",children:[y.jsx("li",{children:"Only one form per staff claim type, with a maximum of 10 receipts"}),y.jsx("li",{children:"Select the number of entries to expand the matching claim blocks"}),y.jsx("li",{children:"Use Sage People for Employee ID (Work Details  Unique ID) and Department (Team Level 1)"})]})]}),(0,y.jsxs)("div",{children:[y.jsx("p",{className:"font-medium text-foreground",children:"E-invoicing notice (Malaysia staff only):"}),y.jsx("p",{children:"Request an e-invoice with company details from suppliers for every claim type except Employee Benefit. Refer to the [Announcement] Changes to Staff Claim Process - E-Invoicing Implementation email for the full process."})]})]})]}),n&&y.jsx(_.Zb,{className:"mb-6 border-green-500 bg-green-50 dark:bg-green-950",children:y.jsx(_.aY,{className:"pt-6",children:(0,y.jsxs)("div",{className:"flex items-center space-x-3",children:[y.jsx(C,{className:"h-6 w-6 text-green-600 dark:text-green-400"}),(0,y.jsxs)("div",{children:[y.jsx("p",{className:"font-medium text-green-900 dark:text-green-100",children:"Claim submitted successfully!"}),y.jsx("p",{className:"text-sm text-green-700 dark:text-green-300",children:"Your claim has been received and is being processed."})]})]})})}),l&&y.jsx(_.Zb,{className:"mb-6 border-red-500 bg-red-50 dark:bg-red-950",children:y.jsx(_.aY,{className:"pt-6",children:(0,y.jsxs)("div",{className:"flex items-center space-x-3",children:[y.jsx(A.Z,{className:"h-6 w-6 text-red-600 dark:text-red-400"}),(0,y.jsxs)("div",{children:[y.jsx("p",{className:"font-medium text-red-900 dark:text-red-100",children:"Submission failed"}),y.jsx("p",{className:"text-sm text-red-700 dark:text-red-300",children:l})]})]})})}),Y&&(0,y.jsxs)(_.Zb,{className:"mb-6 border-emerald-500/60 bg-emerald-50/40 dark:bg-emerald-950/20",children:[(0,y.jsxs)(_.Ol,{className:"flex flex-col gap-1 sm:flex-row sm:items-center sm:justify-between space-y-0",children:[y.jsx("div",{children:(0,y.jsxs)(_.ll,{className:"flex items-center gap-2 text-emerald-900 dark:text-emerald-100",children:[y.jsx(R.Z,{className:"h-5 w-5"}),"Profile Verified"]})}),y.jsx(rD.C,{variant:"success",children:"Verified"})]}),y.jsx(_.aY,{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:Q.map(e=>(0,y.jsxs)("div",{children:[y.jsx("p",{className:"text-xs uppercase text-muted-foreground tracking-wide",children:e.label}),y.jsx("p",{className:"font-semibold text-foreground",children:e.value})]},e.label))})]}),(0,y.jsxs)("form",{onSubmit:eh,className:"space-y-6",children:[(0,y.jsxs)(_.Zb,{children:[(0,y.jsxs)(_.Ol,{children:[y.jsx(_.ll,{children:"Personal Information"}),y.jsx(_.SZ,{children:"All details must match Sage People records"})]}),(0,y.jsxs)(_.aY,{className:"space-y-4",children:[u&&y.jsx("p",{className:"text-xs text-muted-foreground",children:"Auto-filling your profile from HR records..."}),d&&y.jsx("p",{className:"text-xs text-red-500",children:d}),!d&&y.jsx("div",{className:`flex items-center gap-2 rounded-md border px-3 py-2 text-xs ${Y?"border-emerald-200 bg-emerald-50 text-emerald-900 dark:border-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-50":"border-slate-200 bg-muted text-muted-foreground"}`,children:Y?(0,y.jsxs)(y.Fragment,{children:[y.jsx(R.Z,{className:"h-4 w-4"}),y.jsx("span",{children:"Verified via HR records. Contact People & Culture if any detail is incorrect."})]}):(0,y.jsxs)(y.Fragment,{children:[y.jsx(I,{className:"h-4 w-4"}),y.jsx("span",{children:"Provide accurate details exactly as listed in Sage People."})]})}),(0,y.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,y.jsxs)("div",{className:"space-y-2",children:[y.jsx(j._,{htmlFor:"fullName",children:"Your Full Name*"}),y.jsx(k.I,{id:"fullName",name:"fullName",value:O.fullName,onChange:et,required:!0,readOnly:Y,disabled:Y,className:X})]}),(0,y.jsxs)("div",{className:"space-y-2",children:[y.jsx(j._,{htmlFor:"employeeId",children:"Employee ID*"}),y.jsx(k.I,{id:"employeeId",name:"employeeId",value:O.employeeId,onChange:et,required:!0,readOnly:Y,disabled:Y,className:X}),y.jsx("p",{className:"text-xs text-muted-foreground",children:"Refer to Sage People  Work Details  Unique ID."})]})]}),(0,y.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,y.jsxs)("div",{className:"space-y-2",children:[y.jsx(j._,{htmlFor:"department",children:"Department*"}),(0,y.jsxs)("select",{id:"department",name:"department",value:O.department,onChange:et,required:!0,disabled:Y,className:`flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 ${Y?"bg-muted cursor-not-allowed text-muted-foreground":""}`,children:[y.jsx("option",{value:"",children:"Select department"}),eo.map(e=>y.jsx("option",{value:e,children:e},e))]})]}),(0,y.jsxs)("div",{className:"space-y-2",children:[y.jsx(j._,{htmlFor:"regentEmail",children:"Your Regentmarkets Email Address*"}),y.jsx(k.I,{id:"regentEmail",name:"regentEmail",type:"email",value:O.regentEmail,onChange:et,required:!0,placeholder:"name@regentmarkets.com",readOnly:Y,disabled:Y,className:X}),!ec&&O.regentEmail&&y.jsx("p",{className:"text-[13px] text-red-500",children:"Email must end with @regentmarkets.com"})]})]})]})]}),(0,y.jsxs)(_.Zb,{children:[(0,y.jsxs)(_.Ol,{children:[y.jsx(_.ll,{children:"Work Details"}),y.jsx(_.SZ,{children:"Match your Work Details in Sage People"})]}),(0,y.jsxs)(_.aY,{className:"space-y-4",children:[(0,y.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,y.jsxs)("div",{className:"space-y-2",children:[y.jsx(j._,{htmlFor:"location",children:"Your Location*"}),(0,y.jsxs)("select",{id:"location",name:"location",value:O.location,onChange:et,required:!0,disabled:Y,className:`flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 ${Y?"bg-muted cursor-not-allowed text-muted-foreground":""}`,children:[y.jsx("option",{value:"",children:"Select location"}),el.map(e=>y.jsx("option",{value:e,children:e},e))]})]}),(0,y.jsxs)("div",{className:"space-y-2",children:[y.jsx(j._,{htmlFor:"hiringCompany",children:"Your Hiring Company*"}),(0,y.jsxs)("select",{id:"hiringCompany",name:"hiringCompany",value:O.hiringCompany,onChange:et,required:!0,disabled:Y,className:`flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 ${Y?"bg-muted cursor-not-allowed text-muted-foreground":""}`,children:[y.jsx("option",{value:"",children:"Select hiring company"}),rG.map(e=>y.jsx("option",{value:e,children:e},e))]})]})]}),O.hiringCompany&&(0,y.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,y.jsxs)("div",{className:"space-y-2",children:[y.jsx(j._,{htmlFor:"bankAccountNumber",children:"Bank Account Number*"}),y.jsx(k.I,{id:"bankAccountNumber",name:"bankAccountNumber",value:O.bankAccountNumber,onChange:et,required:!0})]}),(0,y.jsxs)("div",{className:"space-y-2",children:[y.jsx(j._,{htmlFor:"bankName",children:"Bank Name*"}),y.jsx(k.I,{id:"bankName",name:"bankName",value:O.bankName,onChange:et,required:!0})]})]})]})]}),(0,y.jsxs)(_.Zb,{children:[(0,y.jsxs)(_.Ol,{children:[y.jsx(_.ll,{children:"Claim Configuration"}),y.jsx(_.SZ,{children:"Select claim type and number of entries"})]}),(0,y.jsxs)(_.aY,{className:"space-y-4",children:[(0,y.jsxs)("div",{className:"space-y-3",children:[y.jsx(j._,{children:"Staff Claim Type*"}),y.jsx("p",{className:"text-xs text-muted-foreground",children:"Choose the category that best matches the receipts you are submitting."}),y.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-300",children:"Each submission supports one claim type only. Switching types clears the receipt count and claim entries so you can re-enter matching receipts."}),y.jsx("input",{type:"hidden",name:"staffClaimType",value:O.staffClaimType}),y.jsx("div",{role:"tablist",className:"grid gap-3 md:grid-cols-2",children:rJ.map(e=>{let t=e.icon,r=O.staffClaimType===e.value;return(0,y.jsxs)("button",{type:"button",role:"tab","aria-selected":r,onClick:()=>er(e.value),className:(0,rL.cn)("flex items-start gap-3 rounded-2xl border px-4 py-3 text-left transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-coral-500",r?"border-coral-500 bg-coral-50 text-coral-900 dark:border-coral-400 dark:bg-coral-900/25 dark:text-coral-50":"border-slate-200 text-slate-700 hover:border-coral-200 hover:bg-slate-50 dark:border-slate-800 dark:bg-slate-900/40 dark:text-slate-200 dark:hover:border-coral-400 dark:hover:bg-slate-900"),children:[y.jsx("div",{className:(0,rL.cn)("rounded-xl p-2",r?"bg-white text-coral-600 dark:bg-coral-800/40 dark:text-coral-50":"bg-slate-100 text-slate-600 dark:bg-slate-800 dark:text-slate-200"),children:y.jsx(t,{className:"h-5 w-5"})}),(0,y.jsxs)("div",{children:[y.jsx("p",{className:"font-semibold",children:e.label}),y.jsx("p",{className:"text-xs text-muted-foreground",children:e.description})]})]},e.value)})}),!O.staffClaimType&&y.jsx("p",{className:"text-xs text-red-500",children:"Select a claim type to continue."})]}),(0,y.jsxs)("div",{className:"space-y-2",children:[y.jsx(j._,{htmlFor:"receiptCount",children:"How many receipts are you claiming?* (Max 10)"}),(0,y.jsxs)("select",{id:"receiptCount",name:"receiptCount",value:O.receiptCount,onChange:e=>{let{value:t}=e.target;N(e=>({...e,receiptCount:t}))},required:!0,className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[y.jsx("option",{value:"",children:"Select receipt count"}),rz.map(e=>y.jsx("option",{value:e,children:e},e))]}),y.jsx("p",{className:"text-xs text-muted-foreground",children:"Selecting a number will expand the form to show the required claim entry blocks."})]})]})]}),z>0&&(0,y.jsxs)(_.Zb,{children:[(0,y.jsxs)(_.Ol,{children:[y.jsx(_.ll,{children:"Claim Entry Section"}),y.jsx(_.SZ,{children:"Complete each entry with currency, amount, and attachment"})]}),y.jsx(_.aY,{className:"space-y-8",children:g.map((e,t)=>{let r=E[t]||{state:"idle"},s=r.message||("success"===r.state?"Values updated from the scanned receipt.":"processing"===r.state?"Scanning receipt":"error"===r.state?"Receipt scan failed. Update manually or try again.":e.attachment?"Use AI scan if the details look incorrect.":"Upload a receipt to auto-fill amount, currency, and description."),i="error"===r.state?"text-red-500":"success"===r.state?"text-emerald-500":"processing"===r.state?"text-amber-500":"text-muted-foreground",a="processing"===r.state?y.jsx(P,{className:"h-3.5 w-3.5 animate-spin"}):"success"===r.state?y.jsx(C,{className:"h-3.5 w-3.5"}):"error"===r.state?y.jsx(A.Z,{className:"h-3.5 w-3.5"}):y.jsx($.Z,{className:"h-3.5 w-3.5"});return(0,y.jsxs)("div",{className:"space-y-4 border-b border-border pb-6 last:border-b-0",children:[(0,y.jsxs)("h3",{className:"font-semibold",children:["Claim ",t+1]}),(0,y.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,y.jsxs)("div",{className:"space-y-2",children:[(0,y.jsxs)(j._,{htmlFor:`claim-${t}-description`,children:["Claim ",t+1," Description*"]}),y.jsx(k.I,{id:`claim-${t}-description`,value:e.description,onChange:e=>es(t,"description",e.target.value),required:!0})]}),(0,y.jsxs)("div",{className:"space-y-2",children:[(0,y.jsxs)(j._,{htmlFor:`claim-${t}-currency`,children:["Claim ",t+1," Currency*"]}),(0,y.jsxs)("select",{id:`claim-${t}-currency`,value:e.currency,onChange:e=>es(t,"currency",e.target.value),required:!0,className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[y.jsx("option",{value:"",children:"Select currency"}),rZ.map(e=>y.jsx("option",{value:e,children:e},e))]})]})]}),(0,y.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,y.jsxs)("div",{className:"space-y-2",children:[y.jsx(j._,{htmlFor:`claim-${t}-date`,children:"Receipt Date*"}),y.jsx(k.I,{id:`claim-${t}-date`,type:"date",value:e.serviceDate,onChange:e=>es(t,"serviceDate",e.target.value),required:!0})]}),(0,y.jsxs)("div",{className:"space-y-2",children:[y.jsx(j._,{htmlFor:`claim-${t}-claimant`,children:"Person / Patient Name*"}),y.jsx(k.I,{id:`claim-${t}-claimant`,value:e.claimantName,onChange:e=>es(t,"claimantName",e.target.value),placeholder:"Enter the staff or dependent name shown on receipt",required:!0})]})]}),(0,y.jsxs)("div",{className:"space-y-2",children:[y.jsx(j._,{htmlFor:`claim-${t}-merchant`,children:"Company / Vendor Name*"}),y.jsx(k.I,{id:`claim-${t}-merchant`,value:e.merchantName,onChange:e=>es(t,"merchantName",e.target.value),placeholder:"Clinic, hospital, airline, merchant, etc.",required:!0}),y.jsx("p",{className:"text-xs text-muted-foreground",children:"We automatically append this name to your claim description for easier review."})]}),"Employee Benefit"===O.staffClaimType&&(0,y.jsxs)("div",{className:"space-y-2",children:[y.jsx(j._,{htmlFor:`claim-${t}-benefitType`,children:"Benefit Type*"}),(0,y.jsxs)("select",{id:`claim-${t}-benefitType`,value:e.benefitType,onChange:e=>es(t,"benefitType",e.target.value),required:!0,className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[y.jsx("option",{value:"",children:"Select benefit type"}),rY.map(e=>y.jsx("option",{value:e,children:e},e))]}),y.jsx("p",{className:"text-xs text-muted-foreground",children:"We use this to auto-validate optical vs. dental vs. health screening claims."})]}),(0,y.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,y.jsxs)("div",{className:"space-y-2",children:[(0,y.jsxs)(j._,{htmlFor:`claim-${t}-amount`,children:["Claim ",t+1," Amount*"]}),y.jsx(k.I,{id:`claim-${t}-amount`,type:"number",min:"0",step:"0.01",value:e.amount,onChange:e=>es(t,"amount",e.target.value),required:!0})]}),(0,y.jsxs)("div",{className:"space-y-2",children:[(0,y.jsxs)(j._,{htmlFor:`claim-${t}-attachment`,children:["Claim ",t+1," Attachment (Invoice, approval and related document)*"]}),(0,y.jsxs)("div",{className:"border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 text-center transition-colors hover:border-coral-300 dark:hover:border-coral-600",onDragOver:e=>{e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="copy"},onDrop:e=>en(e,t,"primary"),children:[y.jsx("input",{id:`claim-${t}-attachment`,type:"file",className:"hidden",required:!0,onChange:e=>{ei(t,e.target.files?e.target.files[0]:null),e.target.value=""},accept:".pdf,.jpg,.jpeg,.png"}),y.jsx("label",{htmlFor:`claim-${t}-attachment`,className:"cursor-pointer block",children:e.attachment?(0,y.jsxs)("div",{className:"flex items-center justify-between gap-4 text-left",children:[(0,y.jsxs)("div",{className:"flex items-center gap-3",children:[y.jsx("div",{className:"h-14 w-14 rounded-md border border-muted-foreground/20 bg-white dark:bg-slate-950 flex items-center justify-center overflow-hidden",children:e.attachmentPreviewUrl?y.jsx("img",{src:e.attachmentPreviewUrl,alt:`Receipt preview for claim ${t+1}`,className:"h-full w-full object-cover"}):y.jsx(U.Z,{className:"h-6 w-6 text-muted-foreground"})}),(0,y.jsxs)("div",{children:[y.jsx("p",{className:"text-sm font-medium break-all",children:e.attachment.name}),(0,y.jsxs)("p",{className:"text-xs text-muted-foreground",children:[((e.attachment.size||0)/1024).toFixed(2)," KB"]})]})]}),(0,y.jsxs)("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),ei(t,null)},className:"inline-flex items-center gap-1 rounded-full border border-slate-200 dark:border-slate-700 px-3 py-1 text-xs text-slate-600 dark:text-slate-300 hover:border-coral-300 dark:hover:border-coral-600",children:[y.jsx(D,{className:"h-3.5 w-3.5"}),"Remove"]})]}):(0,y.jsxs)("div",{className:"space-y-2",children:[y.jsx(L,{className:"h-8 w-8 mx-auto text-muted-foreground"}),y.jsx("p",{className:"text-sm text-muted-foreground",children:"Click or drag a receipt (PDF/JPG/PNG, max 5MB)"})]})})]}),r0&&(0,y.jsxs)("div",{className:"mt-3 space-y-2 text-left",children:[(0,y.jsxs)("p",{className:(0,rL.cn)("flex items-center gap-2 text-xs",i),children:[a,y.jsx("span",{children:s})]}),e.attachment&&"processing"!==r.state&&y.jsx(x.z,{type:"button",variant:"outline",size:"sm",className:"w-fit text-xs",onClick:()=>J(t,e.attachment,{staffClaimType:O.staffClaimType,localCurrency:O.localCurrency,location:O.location,benefitType:"Employee Benefit"===O.staffClaimType&&e.benefitType||void 0}),children:(0,y.jsxs)(y.Fragment,{children:[y.jsx($.Z,{className:"mr-2 h-3.5 w-3.5"}),"Re-run receipt scan"]})})]})]}),(0,y.jsxs)("div",{className:"space-y-2 md:col-span-2",children:[y.jsx(j._,{htmlFor:`claim-${t}-supporting-attachment`,children:"Supporting documents / additional receipts (Optional)"}),(0,y.jsxs)("div",{className:"border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 text-center transition-colors hover:border-coral-300 dark:hover:border-coral-600",onDragOver:e=>{e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="copy"},onDrop:e=>en(e,t,"supporting"),children:[y.jsx("input",{id:`claim-${t}-supporting-attachment`,type:"file",className:"hidden",onChange:e=>{ea(t,e.target.files?e.target.files[0]:null),e.target.value=""},accept:".pdf,.jpg,.jpeg,.png"}),y.jsx("label",{htmlFor:`claim-${t}-supporting-attachment`,className:"cursor-pointer block",children:e.supportingAttachment?(0,y.jsxs)("div",{className:"flex items-center justify-between gap-4 text-left",children:[(0,y.jsxs)("div",{className:"flex items-center gap-3",children:[y.jsx("div",{className:"h-12 w-12 rounded-md border border-muted-foreground/20 bg-white dark:bg-slate-950 flex items-center justify-center overflow-hidden",children:e.supportingAttachmentPreviewUrl?y.jsx("img",{src:e.supportingAttachmentPreviewUrl,alt:`Supporting document preview for claim ${t+1}`,className:"h-full w-full object-cover"}):y.jsx(U.Z,{className:"h-5 w-5 text-muted-foreground"})}),(0,y.jsxs)("div",{children:[y.jsx("p",{className:"text-sm font-medium break-all",children:e.supportingAttachment.name}),(0,y.jsxs)("p",{className:"text-xs text-muted-foreground",children:[((e.supportingAttachment.size||0)/1024).toFixed(2)," KB"]})]})]}),(0,y.jsxs)("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),ea(t,null)},className:"inline-flex items-center gap-1 rounded-full border border-slate-200 dark:border-slate-700 px-3 py-1 text-xs text-slate-600 dark:text-slate-300 hover:border-coral-300 dark:hover:border-coral-600",children:[y.jsx(D,{className:"h-3.5 w-3.5"}),"Remove"]})]}):(0,y.jsxs)("div",{className:"space-y-2",children:[y.jsx(L,{className:"h-8 w-8 mx-auto text-muted-foreground"}),y.jsx("p",{className:"text-sm text-muted-foreground",children:"Drag or click to add approvals, proposals, or extra receipts (optional)"})]})})]}),y.jsx("p",{className:"text-xs text-muted-foreground",children:"Attach any extra documents Finance may need, such as approvals or proposals. Leave blank if not applicable."})]})]}),"Employee Benefit"===O.staffClaimType&&"Optical"===e.benefitType&&(e.isOpticalReceipt||e.opticalVerification)&&(0,y.jsxs)("div",{className:(0,rL.cn)("rounded-md border px-3 py-2 text-xs",e.opticalVerification?.verified?"border-emerald-300 bg-emerald-50 dark:border-emerald-800 dark:bg-emerald-900/20 text-emerald-900 dark:text-emerald-100":"border-amber-300 bg-amber-50 dark:border-amber-800 dark:bg-amber-900/20 text-amber-900 dark:text-amber-100"),children:[(0,y.jsxs)("div",{className:"flex items-center gap-2",children:[e.opticalVerification?.verified?y.jsx(R.Z,{className:"h-4 w-4"}):y.jsx(A.Z,{className:"h-4 w-4"}),y.jsx("p",{className:"font-medium",children:e.opticalVerification?.verified?"Verified optical receipt":"Optical receipt needs manual verification"})]}),y.jsx("p",{className:"mt-1 text-[13px]",children:e.opticalVerification?.note||(e.opticalVerification?.verified?"Detected prescription details for eyewear reimbursement.":"We could not detect prescription details. Upload the prescription page or enter it manually.")})]})]},`claim-entry-${t}`)})})]}),(0,y.jsxs)(_.Zb,{children:[(0,y.jsxs)(_.Ol,{children:[y.jsx(_.ll,{children:"Summary & Submission"}),y.jsx(_.SZ,{children:"Confirm totals and supporting information"})]}),(0,y.jsxs)(_.aY,{className:"space-y-4",children:[(0,y.jsxs)("div",{className:"rounded-2xl border border-amber-300 bg-amber-50/90 p-4 dark:border-amber-900 dark:bg-amber-950/25 space-y-2 shadow-sm",children:[(0,y.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,y.jsxs)("div",{children:[y.jsx("p",{className:"text-sm font-semibold text-amber-900 dark:text-amber-50",children:"Remaining Balance"}),y.jsx("p",{className:"text-xs text-amber-800/80 dark:text-amber-200/80",children:"Mirrors your Employee Benefit dashboard"})]}),V?y.jsx(P,{className:"h-4 w-4 animate-spin text-amber-700 dark:text-amber-200"}):M?y.jsx(rD.C,{variant:"outline",className:"border-red-200 text-red-700 dark:border-red-800 dark:text-red-300",children:"Error"}):y.jsx(rD.C,{variant:"outline",className:"border-amber-300 text-amber-700 dark:border-amber-800 dark:text-amber-200",children:"Synced"})]}),y.jsx("div",{className:"text-2xl font-bold text-amber-900 dark:text-amber-100",children:ep&&!M?H(ed.remaining,ed.currency):""}),M?y.jsx("p",{className:"text-xs text-red-600 dark:text-red-300",children:M}):y.jsx("p",{className:"text-xs text-amber-900/80 dark:text-amber-100/70",children:"You are entitled to this balance for the current plan year. Based on the receipts you submit, you can only claim up to this number."}),ef&&(0,y.jsxs)("div",{className:"rounded-lg border border-red-200 bg-red-50 px-3 py-3 text-sm font-medium text-red-700 dark:border-red-800 dark:bg-red-950/40 dark:text-white",children:[(0,y.jsxs)("p",{children:["Your claim total exceeds your remaining balance by"," ",H(em,ed.currency),"."]}),(0,y.jsxs)("p",{className:"text-xs mt-1 text-red-600 dark:text-white/80",children:["You will only receive ",H(ed.remaining,ed.currency)," after submission."]})]}),ey&&y.jsx("div",{className:"rounded-lg border border-slate-300 bg-white px-3 py-3 text-sm font-medium text-slate-900 shadow-sm dark:border-slate-800 dark:bg-slate-950 dark:text-slate-100",children:(0,y.jsxs)("div",{className:"flex flex-col gap-1",children:[y.jsx("span",{className:"text-xs uppercase tracking-wide text-slate-600 dark:text-slate-400",children:"Balance after this claim"}),(0,y.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,y.jsxs)("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:[H(ed.remaining,ed.currency)," "," ",H(Z,ed.currency)]}),y.jsx("div",{className:"text-lg font-bold",children:H(eg,ed.currency)})]}),y.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Well update your balance with this figure once Finance approves the claim."})]})})]}),(0,y.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,y.jsxs)("div",{className:"space-y-2",children:[y.jsx(j._,{htmlFor:"headcount",children:"Headcount (Applicable for team building/lunch)"}),y.jsx(k.I,{id:"headcount",name:"headcount",value:O.headcount,onChange:et,placeholder:"Enter headcount if applicable"})]}),(0,y.jsxs)("div",{className:"space-y-2",children:[y.jsx(j._,{htmlFor:"localCurrency",children:"Local Currency*"}),(0,y.jsxs)("select",{id:"localCurrency",name:"localCurrency",value:O.localCurrency,onChange:et,required:!0,className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[y.jsx("option",{value:"",children:"Select local currency"}),rZ.map(e=>y.jsx("option",{value:e,children:e},e))]})]})]}),(0,y.jsxs)("div",{className:"space-y-2",children:[y.jsx(j._,{htmlFor:"totalAmount",children:"Total Amount*"}),y.jsx(k.I,{id:"totalAmount",name:"totalAmount",value:Z.toFixed(2),readOnly:!0,placeholder:"0.00"}),y.jsx("p",{className:"text-xs text-muted-foreground",children:"Automatically calculated based on all claim entry amounts. Ensure it matches your supporting documents."})]}),(0,y.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row",children:[y.jsx(x.z,{type:"submit",disabled:!eu||i,className:"flex-1",children:i?(0,y.jsxs)(y.Fragment,{children:[y.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Submitting..."]}):(0,y.jsxs)(y.Fragment,{children:[y.jsx(U.Z,{className:"h-4 w-4 mr-2"}),"Submit Claim"]})}),y.jsx(x.z,{type:"button",variant:"outline",onClick:()=>e.push("/dashboard"),children:"Cancel"})]})]})]})]}),(0,y.jsxs)(_.Zb,{className:"mt-6",children:[y.jsx(_.Ol,{children:y.jsx(_.ll,{className:"text-sm",children:"Form Tips"})}),(0,y.jsxs)(_.aY,{className:"text-sm text-muted-foreground space-y-2",children:[y.jsx("p",{children:" Only one form per staff claim type with up to 10 receipts."}),y.jsx("p",{children:" Upload clear receipts plus approval conversations for every entry."}),y.jsx("p",{children:" Malaysia staff (except Employee Benefit claims) must request supplier e-invoices."}),y.jsx("p",{children:" Use Sage People to confirm Unique ID, Department, Hiring Company, and location."})]})]})]})]})}},567:(e,t,r)=>{"use strict";r.d(t,{C:()=>n});var s=r(326);r(7577);var i=r(7863);let a={default:"bg-muted text-foreground",success:"bg-emerald-600 text-white",warning:"bg-amber-500 text-black",danger:"bg-red-600 text-white",secondary:"bg-slate-200 text-slate-900 dark:bg-slate-800 dark:text-slate-100",outline:"border border-slate-300 dark:border-slate-700 text-slate-800 dark:text-slate-100"};function n({variant:e="default",className:t,...r}){return s.jsx("span",{className:(0,i.cn)("inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold",a[e],t),...r})}},4432:(e,t,r)=>{"use strict";r.d(t,{I:()=>n});var s=r(326),i=r(7577),a=r(7863);let n=i.forwardRef(({className:e,type:t,...r},i)=>s.jsx("input",{type:t,className:(0,a.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:i,...r}));n.displayName="Input"},5842:(e,t,r)=>{"use strict";r.d(t,{_:()=>u});var s=r(326),i=r(7577),a=r(5226),n=i.forwardRef((e,t)=>(0,s.jsx)(a.WV.label,{...e,ref:t,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));n.displayName="Label";var o=r(9360),l=r(7863);let c=(0,o.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),u=i.forwardRef(({className:e,...t},r)=>s.jsx(n,{ref:r,className:(0,l.cn)(c(),e),...t}));u.displayName=n.displayName},4827:(e,t,r)=>{"use strict";process.env.NEXT_PUBLIC_SUPABASE_EMPLOYEE_TABLE},4499:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});let s=r(5826).__importDefault(r(3309));class i{constructor(e){var t,r;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=null!==(t=e.shouldThrowOnError)&&void 0!==t&&t,this.signal=e.signal,this.isMaybeSingle=null!==(r=e.isMaybeSingle)&&void 0!==r&&r,e.fetch?this.fetch=e.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),"GET"!==this.method&&"HEAD"!==this.method&&this.headers.set("Content-Type","application/json");let r=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async e=>{var t,r,i,a;let n=null,o=null,l=null,c=e.status,u=e.statusText;if(e.ok){if("HEAD"!==this.method){let r=await e.text();""===r||(o="text/csv"===this.headers.get("Accept")?r:this.headers.get("Accept")&&(null===(t=this.headers.get("Accept"))||void 0===t?void 0:t.includes("application/vnd.pgrst.plan+text"))?r:JSON.parse(r))}let s=null===(r=this.headers.get("Prefer"))||void 0===r?void 0:r.match(/count=(exact|planned|estimated)/),a=null===(i=e.headers.get("content-range"))||void 0===i?void 0:i.split("/");s&&a&&a.length>1&&(l=parseInt(a[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(o)&&(o.length>1?(n={code:"PGRST116",details:`Results contain ${o.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},o=null,l=null,c=406,u="Not Acceptable"):o=1===o.length?o[0]:null)}else{let t=await e.text();try{n=JSON.parse(t),Array.isArray(n)&&404===e.status&&(o=[],n=null,c=200,u="OK")}catch(r){404===e.status&&""===t?(c=204,u="No Content"):n={message:t}}if(n&&this.isMaybeSingle&&(null===(a=null==n?void 0:n.details)||void 0===a?void 0:a.includes("0 rows"))&&(n=null,c=200,u="OK"),n&&this.shouldThrowOnError)throw new s.default(n)}return{error:n,data:o,count:l,status:c,statusText:u}});return this.shouldThrowOnError||(r=r.catch(e=>{var t,r,s;return{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:`${null!==(r=null==e?void 0:e.stack)&&void 0!==r?r:""}`,hint:"",code:`${null!==(s=null==e?void 0:e.code)&&void 0!==s?s:""}`},data:null,count:null,status:0,statusText:""}})),r.then(e,t)}returns(){return this}overrideTypes(){return this}}t.default=i},787:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});let s=r(5826),i=s.__importDefault(r(3487)),a=s.__importDefault(r(2965));class n{constructor(e,{headers:t={},schema:r,fetch:s}={}){this.url=e,this.headers=new Headers(t),this.schemaName=r,this.fetch=s}from(e){let t=new URL(`${this.url}/${e}`);return new i.default(t,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new n(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:s=!1,count:i}={}){var n;let o,l;let c=new URL(`${this.url}/rpc/${e}`);r||s?(o=r?"HEAD":"GET",Object.entries(t).filter(([e,t])=>void 0!==t).map(([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`]).forEach(([e,t])=>{c.searchParams.append(e,t)})):(o="POST",l=t);let u=new Headers(this.headers);return i&&u.set("Prefer",`count=${i}`),new a.default({method:o,url:c,headers:u,schema:this.schemaName,body:l,fetch:null!==(n=this.fetch)&&void 0!==n?n:fetch})}}t.default=n},3309:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}t.default=r},2965:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});let s=r(5826).__importDefault(r(4736)),i=RegExp("[,()]");class a extends s.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){let r=Array.from(new Set(t)).map(e=>"string"==typeof e&&i.test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:s}={}){let i="";"plain"===s?i="pl":"phrase"===s?i="ph":"websearch"===s&&(i="w");let a=void 0===r?"":`(${r})`;return this.url.searchParams.append(e,`${i}fts${a}.${t}`),this}match(e){return Object.entries(e).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){let s=r?`${r}.or`:"or";return this.url.searchParams.append(s,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}}t.default=a},3487:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});let s=r(5826).__importDefault(r(2965));class i{constructor(e,{headers:t={},schema:r,fetch:s}){this.url=e,this.headers=new Headers(t),this.schema=r,this.fetch=s}select(e,t){let{head:r=!1,count:i}=null!=t?t:{},a=!1,n=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!a?"":('"'===e&&(a=!a),e)).join("");return this.url.searchParams.set("select",n),i&&this.headers.append("Prefer",`count=${i}`),new s.default({method:r?"HEAD":"GET",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e,{count:t,defaultToNull:r=!0}={}){var i;if(t&&this.headers.append("Prefer",`count=${t}`),r||this.headers.append("Prefer","missing=default"),Array.isArray(e)){let t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){let e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new s.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(i=this.fetch)&&void 0!==i?i:fetch})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:i,defaultToNull:a=!0}={}){var n;if(this.headers.append("Prefer",`resolution=${r?"ignore":"merge"}-duplicates`),void 0!==t&&this.url.searchParams.set("on_conflict",t),i&&this.headers.append("Prefer",`count=${i}`),a||this.headers.append("Prefer","missing=default"),Array.isArray(e)){let t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){let e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new s.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(n=this.fetch)&&void 0!==n?n:fetch})}update(e,{count:t}={}){var r;return t&&this.headers.append("Prefer",`count=${t}`),new s.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(r=this.fetch)&&void 0!==r?r:fetch})}delete({count:e}={}){var t;return e&&this.headers.append("Prefer",`count=${e}`),new s.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:null!==(t=this.fetch)&&void 0!==t?t:fetch})}}t.default=i},4736:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});let s=r(5826).__importDefault(r(4499));class i extends s.default{select(e){let t=!1,r=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:s,referencedTable:i=s}={}){let a=i?`${i}.order`:"order",n=this.url.searchParams.get(a);return this.url.searchParams.set(a,`${n?`${n},`:""}${e}.${t?"asc":"desc"}${void 0===r?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){let s=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:s=r}={}){let i=void 0===s?"offset":`${s}.offset`,a=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(a,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return"GET"===this.method?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:s=!1,wal:i=!1,format:a="text"}={}){var n;let o=[e?"analyze":null,t?"verbose":null,r?"settings":null,s?"buffers":null,i?"wal":null].filter(Boolean).join("|"),l=null!==(n=this.headers.get("Accept"))&&void 0!==n?n:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${a}; for="${l}"; options=${o};`),this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}}t.default=i},5802:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PostgrestError=t.PostgrestBuilder=t.PostgrestTransformBuilder=t.PostgrestFilterBuilder=t.PostgrestQueryBuilder=t.PostgrestClient=void 0;let s=r(5826),i=s.__importDefault(r(787));t.PostgrestClient=i.default;let a=s.__importDefault(r(3487));t.PostgrestQueryBuilder=a.default;let n=s.__importDefault(r(2965));t.PostgrestFilterBuilder=n.default;let o=s.__importDefault(r(4736));t.PostgrestTransformBuilder=o.default;let l=s.__importDefault(r(4499));t.PostgrestBuilder=l.default;let c=s.__importDefault(r(3309));t.PostgrestError=c.default,t.default={PostgrestClient:i.default,PostgrestQueryBuilder:a.default,PostgrestFilterBuilder:n.default,PostgrestTransformBuilder:o.default,PostgrestBuilder:l.default,PostgrestError:c.default}},1291:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(2881).Z)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},763:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(2881).Z)("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},1572:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(2881).Z)("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]])},2870:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>n,__esModule:()=>a,default:()=>o});var s=r(8570);let i=(0,s.createProxy)(String.raw`/Users/aidillfitri/Documents/Work/Github projects/claim_web_app_project/app/submit-claim/page.tsx`),{__esModule:a,$$typeof:n}=i;i.default;let o=(0,s.createProxy)(String.raw`/Users/aidillfitri/Documents/Work/Github projects/claim_web_app_project/app/submit-claim/page.tsx#default`)}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,740,270,640,768],()=>r(1337));module.exports=s})();